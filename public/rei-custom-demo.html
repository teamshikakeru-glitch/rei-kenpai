<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¤¼ã‚«ã‚¹ã‚¿ãƒ  â€” è‘¬å„€ç¤¾æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ  ãƒ‡ãƒ¢</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ============ RESET & VARIABLES ============ */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

:root {
  --bg-primary: #0f1117;
  --bg-secondary: #181b25;
  --bg-card: #1e2230;
  --bg-card-hover: #252a3a;
  --border: #2a2f42;
  --border-light: #353b52;
  --text-primary: #e8eaf0;
  --text-secondary: #9399ad;
  --text-muted: #5f6580;
  --accent: #c9a96e;
  --accent-light: #dfc48e;
  --accent-dark: #a6863f;
  --accent-glow: rgba(201,169,110,0.15);
  --success: #5cb87a;
  --danger: #e05c5c;
  --info: #5c9de0;
  --warning: #e0a85c;
  --radius-sm: 6px;
  --radius: 10px;
  --radius-lg: 16px;
  --shadow: 0 2px 12px rgba(0,0,0,0.3);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.4);
  --transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

html { font-size: 15px; }
body {
  font-family: 'Zen Kaku Gothic New', 'Noto Sans JP', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ============ LAYOUT ============ */
.app {
  display: flex;
  min-height: 100vh;
}

/* Sidebar */
.sidebar {
  width: 260px;
  background: var(--bg-secondary);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  z-index: 100;
  transition: transform var(--transition);
}

.sidebar-header {
  padding: 24px 20px;
  border-bottom: 1px solid var(--border);
}

.sidebar-logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-mark {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--accent), var(--accent-dark));
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 700;
  color: #0f1117;
  letter-spacing: -1px;
}

.logo-text {
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: 1px;
}

.logo-sub {
  font-size: 0.7rem;
  color: var(--text-muted);
  letter-spacing: 0.5px;
  margin-top: 2px;
}

.sidebar-nav {
  flex: 1;
  padding: 16px 12px;
  overflow-y: auto;
}

.nav-section-label {
  font-size: 0.65rem;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 2px;
  padding: 12px 12px 6px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 11px 14px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  color: var(--text-secondary);
  font-size: 0.9rem;
  font-weight: 400;
  transition: all var(--transition);
  margin-bottom: 2px;
  border: 1px solid transparent;
}

.nav-item:hover {
  background: var(--bg-card);
  color: var(--text-primary);
}

.nav-item.active {
  background: var(--accent-glow);
  color: var(--accent-light);
  border-color: rgba(201,169,110,0.2);
  font-weight: 500;
}

.nav-icon {
  width: 20px;
  text-align: center;
  font-size: 1rem;
  flex-shrink: 0;
}

.sidebar-footer {
  padding: 16px 20px;
  border-top: 1px solid var(--border);
}

.demo-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(201,169,110,0.1);
  color: var(--accent);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 1px;
}

.demo-badge::before {
  content: '';
  width: 6px;
  height: 6px;
  background: var(--accent);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* Main content */
.main {
  flex: 1;
  margin-left: 260px;
  min-height: 100vh;
}

.main-header {
  padding: 20px 32px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--bg-secondary);
  position: sticky;
  top: 0;
  z-index: 50;
}

.main-title {
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--text-primary);
  letter-spacing: 0.5px;
}

.main-title-sub {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-top: 2px;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 16px;
}

.header-company {
  font-size: 0.85rem;
  color: var(--text-secondary);
}

.header-avatar {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, var(--accent), var(--accent-dark));
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  font-weight: 700;
  color: #0f1117;
}

.main-body {
  padding: 28px 32px;
}

/* Page sections */
.page { display: none; }
.page.active { display: block; animation: fadeIn 0.35s ease; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ============ CARDS ============ */
.card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  margin-bottom: 20px;
  transition: border-color var(--transition);
}

.card:hover {
  border-color: var(--border-light);
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.card-title {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
  letter-spacing: 0.3px;
}

.card-subtitle {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-top: 2px;
}

/* ============ STATS GRID ============ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  transition: all var(--transition);
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--stat-color, var(--accent));
}

.stat-card:hover {
  border-color: var(--border-light);
  transform: translateY(-2px);
}

.stat-label {
  font-size: 0.73rem;
  color: var(--text-muted);
  font-weight: 500;
  letter-spacing: 0.5px;
}

.stat-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-top: 8px;
  line-height: 1;
}

.stat-unit {
  font-size: 0.8rem;
  font-weight: 400;
  color: var(--text-secondary);
  margin-left: 2px;
}

.stat-change {
  font-size: 0.72rem;
  margin-top: 8px;
  font-weight: 500;
}

.stat-change.up { color: var(--success); }
.stat-change.down { color: var(--danger); }

/* ============ TABLE ============ */
.table-wrap {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  text-align: left;
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
  white-space: nowrap;
}

td {
  padding: 14px;
  font-size: 0.88rem;
  border-bottom: 1px solid rgba(42,47,66,0.5);
  color: var(--text-secondary);
  white-space: nowrap;
}

tr:hover td {
  background: rgba(30,34,48,0.5);
  color: var(--text-primary);
}

/* ============ BUTTONS ============ */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  border-radius: var(--radius-sm);
  font-size: 0.85rem;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid transparent;
  transition: all var(--transition);
  font-family: inherit;
  letter-spacing: 0.3px;
}

.btn-primary {
  background: linear-gradient(135deg, var(--accent), var(--accent-dark));
  color: #0f1117;
  border-color: var(--accent);
}

.btn-primary:hover {
  box-shadow: 0 0 20px var(--accent-glow);
  transform: translateY(-1px);
}

.btn-secondary {
  background: var(--bg-card);
  color: var(--text-secondary);
  border-color: var(--border);
}

.btn-secondary:hover {
  border-color: var(--border-light);
  color: var(--text-primary);
}

.btn-sm {
  padding: 6px 14px;
  font-size: 0.78rem;
}

.btn-icon {
  width: 32px;
  height: 32px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-sm);
  background: var(--bg-card);
  border: 1px solid var(--border);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all var(--transition);
}

.btn-icon:hover {
  border-color: var(--accent);
  color: var(--accent);
}

/* ============ FORM ELEMENTS ============ */
.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  font-size: 0.78rem;
  font-weight: 500;
  color: var(--text-secondary);
  margin-bottom: 6px;
  letter-spacing: 0.3px;
}

.form-input, .form-select, .form-textarea {
  width: 100%;
  padding: 10px 14px;
  background: var(--bg-primary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 0.88rem;
  font-family: inherit;
  transition: border-color var(--transition);
  outline: none;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
  border-color: var(--accent);
}

.form-select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239399ad' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 36px;
}

.form-textarea {
  resize: vertical;
  min-height: 80px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

/* ============ TAGS & BADGES ============ */
.tag {
  display: inline-flex;
  align-items: center;
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.3px;
}

.tag-success { background: rgba(92,184,122,0.15); color: var(--success); }
.tag-danger { background: rgba(224,92,92,0.15); color: var(--danger); }
.tag-info { background: rgba(92,157,224,0.15); color: var(--info); }
.tag-warning { background: rgba(224,168,92,0.15); color: var(--warning); }
.tag-accent { background: var(--accent-glow); color: var(--accent); }

/* ============ CHARTS (CSS only) ============ */
.bar-chart {
  display: flex;
  align-items: flex-end;
  gap: 6px;
  height: 200px;
  padding-top: 20px;
}

.bar-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  height: 100%;
  justify-content: flex-end;
}

.bar {
  width: 100%;
  max-width: 40px;
  border-radius: 4px 4px 0 0;
  background: linear-gradient(180deg, var(--accent), var(--accent-dark));
  transition: height 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
  min-height: 4px;
}

.bar:hover {
  filter: brightness(1.2);
}

.bar-value {
  font-size: 0.68rem;
  font-weight: 600;
  color: var(--text-secondary);
}

.bar-label {
  font-size: 0.68rem;
  color: var(--text-muted);
  white-space: nowrap;
}

.bar-chart-secondary .bar {
  background: linear-gradient(180deg, var(--info), #3a6fad);
}

/* Horizontal bar chart */
.h-bar-chart {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.h-bar-row {
  display: flex;
  align-items: center;
  gap: 14px;
}

.h-bar-name {
  width: 80px;
  font-size: 0.82rem;
  color: var(--text-secondary);
  text-align: right;
  flex-shrink: 0;
}

.h-bar-track {
  flex: 1;
  height: 28px;
  background: var(--bg-primary);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.h-bar-fill {
  height: 100%;
  border-radius: 4px;
  background: linear-gradient(90deg, var(--accent-dark), var(--accent));
  transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-right: 10px;
}

.h-bar-val {
  font-size: 0.72rem;
  font-weight: 700;
  color: #0f1117;
}

.h-bar-amount {
  width: 90px;
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--text-primary);
  text-align: right;
  flex-shrink: 0;
}

/* ============ ESTIMATE BUILDER ============ */
.estimate-layout {
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 24px;
}

.plan-cards {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 20px;
}

.plan-card {
  background: var(--bg-primary);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  padding: 18px;
  cursor: pointer;
  transition: all var(--transition);
  text-align: center;
  position: relative;
}

.plan-card:hover {
  border-color: var(--border-light);
}

.plan-card.selected {
  border-color: var(--accent);
  background: var(--accent-glow);
}

.plan-card.selected::after {
  content: 'âœ“';
  position: absolute;
  top: 8px;
  right: 10px;
  color: var(--accent);
  font-weight: 700;
  font-size: 0.9rem;
}

.plan-name {
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.plan-price {
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--accent);
}

.plan-price-unit {
  font-size: 0.72rem;
  color: var(--text-muted);
  font-weight: 400;
}

.plan-desc {
  font-size: 0.72rem;
  color: var(--text-muted);
  margin-top: 6px;
  line-height: 1.4;
}

.option-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.option-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px;
  background: var(--bg-primary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition);
}

.option-item:hover {
  border-color: var(--border-light);
}

.option-item.on {
  border-color: var(--accent);
  background: var(--accent-glow);
}

.option-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.option-toggle {
  width: 36px;
  height: 20px;
  background: var(--border);
  border-radius: 10px;
  position: relative;
  transition: background var(--transition);
  flex-shrink: 0;
}

.option-toggle::after {
  content: '';
  position: absolute;
  width: 16px;
  height: 16px;
  background: var(--text-muted);
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: all var(--transition);
}

.option-item.on .option-toggle {
  background: var(--accent);
}

.option-item.on .option-toggle::after {
  left: 18px;
  background: #0f1117;
}

.option-name {
  font-size: 0.85rem;
  color: var(--text-secondary);
}

.option-item.on .option-name {
  color: var(--text-primary);
}

.option-price {
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--text-muted);
  white-space: nowrap;
}

.option-item.on .option-price {
  color: var(--accent);
}

/* Estimate summary panel */
.estimate-summary {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  position: sticky;
  top: 100px;
}

.summary-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
}

.summary-items {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 20px;
}

.summary-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.82rem;
}

.summary-item-name {
  color: var(--text-secondary);
}

.summary-item-price {
  color: var(--text-primary);
  font-weight: 500;
}

.summary-divider {
  border: none;
  border-top: 1px solid var(--border);
  margin: 16px 0;
}

.summary-total {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
}

.summary-total-label {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text-primary);
}

.summary-total-price {
  font-size: 1.6rem;
  font-weight: 700;
  color: var(--accent);
}

.summary-total-tax {
  font-size: 0.72rem;
  color: var(--text-muted);
  text-align: right;
  margin-top: 4px;
}

.summary-actions {
  margin-top: 20px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* ============ CUSTOMER PAGE ============ */
.search-bar {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.search-input-wrap {
  flex: 1;
  min-width: 200px;
  position: relative;
}

.search-input-wrap .form-input {
  padding-left: 36px;
}

.search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-muted);
  font-size: 0.9rem;
}

/* Customer detail modal */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
  z-index: 200;
  justify-content: center;
  align-items: center;
}

.modal-overlay.show {
  display: flex;
  animation: fadeIn 0.2s ease;
}

.modal {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  width: 640px;
  max-height: 80vh;
  overflow-y: auto;
  padding: 28px;
  box-shadow: var(--shadow-lg);
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.modal-title {
  font-size: 1.1rem;
  font-weight: 600;
}

.modal-close {
  width: 32px;
  height: 32px;
  background: none;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  transition: all var(--transition);
}

.modal-close:hover {
  border-color: var(--danger);
  color: var(--danger);
}

.detail-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.detail-item {
  padding: 12px;
  background: var(--bg-primary);
  border-radius: var(--radius-sm);
}

.detail-label {
  font-size: 0.7rem;
  color: var(--text-muted);
  font-weight: 500;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  margin-bottom: 4px;
}

.detail-value {
  font-size: 0.9rem;
  color: var(--text-primary);
  font-weight: 500;
}

.detail-full {
  grid-column: 1 / -1;
}

/* ============ GRID HELPERS ============ */
.grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

/* ============ RESPONSIVE ============ */
.mobile-toggle {
  display: none;
  position: fixed;
  top: 12px;
  left: 12px;
  z-index: 150;
  width: 40px;
  height: 40px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 1.2rem;
  cursor: pointer;
  align-items: center;
  justify-content: center;
}

@media (max-width: 1024px) {
  .estimate-layout {
    grid-template-columns: 1fr;
  }
  .estimate-summary {
    position: static;
  }
}

@media (max-width: 768px) {
  .mobile-toggle { display: flex; }
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left: 0; }
  .main-header { padding: 16px 16px 16px 60px; }
  .main-body { padding: 16px; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .plan-cards { grid-template-columns: 1fr; }
  .grid-2 { grid-template-columns: 1fr; }
  .form-row { grid-template-columns: 1fr; }
  .detail-grid { grid-template-columns: 1fr; }
  .modal { width: 95%; margin: 16px; }
}

/* ============ SCROLLBAR ============ */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--border-light); }

/* ============ PRINT ESTIMATE ============ */
.print-only { display: none; }

@media print {
  .sidebar, .main-header, .mobile-toggle, .btn, .nav-item { display: none !important; }
  .main { margin-left: 0 !important; }
  .main-body { padding: 0 !important; }
  .page { display: none !important; }
  .page.print-target { display: block !important; }
  .print-only { display: block !important; }
  .card { border: 1px solid #ccc !important; break-inside: avoid; }
  body { background: #fff; color: #111; }
  .stat-card::before { display: none; }
}
</style>
</head>
<body>
<div class="app">

  <!-- Mobile toggle -->
  <button class="mobile-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">â˜°</button>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <div class="logo-mark">ç¤¼</div>
        <div>
          <div class="logo-text">ç¤¼ ã‚«ã‚¹ã‚¿ãƒ </div>
          <div class="logo-sub">Funeral Management System</div>
        </div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section-label">ãƒ¡ã‚¤ãƒ³</div>
      <div class="nav-item active" data-page="dashboard">
        <span class="nav-icon">ğŸ“Š</span>
        <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
      </div>

      <div class="nav-section-label">æ¥­å‹™</div>
      <div class="nav-item" data-page="estimate">
        <span class="nav-icon">ğŸ“‹</span>
        <span>è¦‹ç©ä½œæˆ</span>
      </div>
      <div class="nav-item" data-page="customer">
        <span class="nav-icon">ğŸ‘¤</span>
        <span>é¡§å®¢ç®¡ç†</span>
      </div>

      <div class="nav-section-label">åˆ†æ</div>
      <div class="nav-item" data-page="cases">
        <span class="nav-icon">ğŸ“ˆ</span>
        <span>æ–½è¡Œä»¶æ•°</span>
      </div>
      <div class="nav-item" data-page="sales">
        <span class="nav-icon">ğŸ’°</span>
        <span>æ‹…å½“è€…åˆ¥å£²ä¸Š</span>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="demo-badge">DEMO MODE</div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <header class="main-header">
      <div>
        <div class="main-title" id="pageTitle">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
        <div class="main-title-sub" id="pageSubtitle">çµŒå–¶çŠ¶æ³ã‚’ã²ã¨ç›®ã§æŠŠæ¡</div>
      </div>
      <div class="header-right">
        <span class="header-company">ãƒ†ã‚¹ãƒˆAç¤¾</span>
        <div class="header-avatar">A</div>
      </div>
    </header>

    <div class="main-body">

      <!-- ===== DASHBOARD ===== -->
      <div class="page active" id="page-dashboard">
        <div class="stats-grid">
          <div class="stat-card" style="--stat-color: var(--accent);">
            <div class="stat-label">ä»Šæœˆã®æ–½è¡Œä»¶æ•°</div>
            <div class="stat-value">24<span class="stat-unit">ä»¶</span></div>
            <div class="stat-change up">â†‘ 12% å‰æœˆæ¯”</div>
          </div>
          <div class="stat-card" style="--stat-color: var(--info);">
            <div class="stat-label">ä»Šæœˆã®å£²ä¸Š</div>
            <div class="stat-value">3,840<span class="stat-unit">ä¸‡å††</span></div>
            <div class="stat-change up">â†‘ 8% å‰æœˆæ¯”</div>
          </div>
          <div class="stat-card" style="--stat-color: var(--success);">
            <div class="stat-label">å¹³å‡å˜ä¾¡</div>
            <div class="stat-value">160<span class="stat-unit">ä¸‡å††</span></div>
            <div class="stat-change down">â†“ 3% å‰æœˆæ¯”</div>
          </div>
          <div class="stat-card" style="--stat-color: var(--warning);">
            <div class="stat-label">ç¤¼ï¼ˆçŒ®æ¯ï¼‰ä»¶æ•°</div>
            <div class="stat-value">87<span class="stat-unit">ä»¶</span></div>
            <div class="stat-change up">â†‘ 25% å‰æœˆæ¯”</div>
          </div>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">æœˆåˆ¥æ–½è¡Œä»¶æ•°</div>
                <div class="card-subtitle">2025å¹´åº¦</div>
              </div>
            </div>
            <div class="bar-chart" id="dashboardChart"></div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">æ‹…å½“è€…åˆ¥ å£²ä¸Šãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
                <div class="card-subtitle">ä»Šæœˆ</div>
              </div>
            </div>
            <div class="h-bar-chart" id="dashboardRanking"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">ç›´è¿‘ã®æ–½è¡Œ</div>
              <div class="card-subtitle">æœ€æ–°10ä»¶</div>
            </div>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>æ—¥ä»˜</th>
                  <th>æ•…äººå</th>
                  <th>æ–½ä¸»å</th>
                  <th>ãƒ—ãƒ©ãƒ³</th>
                  <th>é‡‘é¡</th>
                  <th>æ‹…å½“</th>
                  <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                </tr>
              </thead>
              <tbody id="recentCasesTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ===== ESTIMATE ===== -->
      <div class="page" id="page-estimate">
        <div class="estimate-layout">
          <div>
            <!-- Step 1: Plan selection -->
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">STEP 1 â€” ãƒ—ãƒ©ãƒ³é¸æŠ</div>
                  <div class="card-subtitle">ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ãƒ—ãƒ©ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„</div>
                </div>
              </div>
              <div class="plan-cards" id="planCards"></div>
            </div>

            <!-- Step 2: Options -->
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">STEP 2 â€” ã‚ªãƒ—ã‚·ãƒ§ãƒ³é¸æŠ</div>
                  <div class="card-subtitle">ON/OFFã§é‡‘é¡ãŒè‡ªå‹•åæ˜ ã•ã‚Œã¾ã™</div>
                </div>
              </div>
              <div class="option-list" id="optionList"></div>
            </div>

            <!-- Step 3: Customer info -->
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">STEP 3 â€” æ–½ä¸»æƒ…å ±</div>
                  <div class="card-subtitle">è¦‹ç©æ›¸ã«è¨˜è¼‰ã™ã‚‹æƒ…å ±</div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">æ–½ä¸»å</label>
                  <input class="form-input" id="estClientName" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ" value="å±±ç”° å¤ªéƒ">
                </div>
                <div class="form-group">
                  <label class="form-label">æ•…äººå</label>
                  <input class="form-input" id="estDeceasedName" placeholder="ä¾‹ï¼šå±±ç”° èŠ±å­" value="å±±ç”° èŠ±å­">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">é›»è©±ç•ªå·</label>
                  <input class="form-input" id="estPhone" placeholder="090-xxxx-xxxx" value="090-1234-5678">
                </div>
                <div class="form-group">
                  <label class="form-label">æ–½è¡Œäºˆå®šæ—¥</label>
                  <input class="form-input" type="date" id="estDate" value="2026-02-10">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">å‚™è€ƒ</label>
                <textarea class="form-textarea" id="estNote" placeholder="ç‰¹è¨˜äº‹é …ãŒã‚ã‚Œã°ã”å…¥åŠ›ãã ã•ã„">å®¶æ—è‘¬ã‚’å¸Œæœ›ã€‚å‚åˆ—è€…30åç¨‹åº¦ã®è¦‹è¾¼ã¿ã€‚</textarea>
              </div>
            </div>
          </div>

          <!-- Summary panel -->
          <div>
            <div class="estimate-summary">
              <div class="summary-title">è¦‹ç©ã‚µãƒãƒªãƒ¼</div>
              <div class="summary-items" id="summaryItems"></div>
              <hr class="summary-divider">
              <div class="summary-total">
                <div class="summary-total-label">åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</div>
                <div class="summary-total-price" id="summaryTotal">Â¥0</div>
              </div>
              <div class="summary-total-tax" id="summaryTax">ï¼ˆç¨æŠœ: Â¥0ï¼‰</div>
              <div class="summary-actions">
                <button class="btn btn-primary" onclick="saveEstimate()" style="width:100%;justify-content:center;">
                  ğŸ’¾ è¦‹ç©ã‚’ä¿å­˜
                </button>
                <button class="btn btn-secondary" onclick="printEstimate()" style="width:100%;justify-content:center;">
                  ğŸ–¨ å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ===== CUSTOMER ===== -->
      <div class="page" id="page-customer">
        <div class="search-bar">
          <div class="search-input-wrap">
            <span class="search-icon">ğŸ”</span>
            <input class="form-input" id="customerSearch" placeholder="æ–½ä¸»åãƒ»æ•…äººåã§æ¤œç´¢..." oninput="filterCustomers()">
          </div>
          <select class="form-select" id="customerAreaFilter" onchange="filterCustomers()" style="width:160px;">
            <option value="">å…¨ã‚¨ãƒªã‚¢</option>
            <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
            <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
            <option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option>
            <option value="åƒè‘‰çœŒ">åƒè‘‰çœŒ</option>
          </select>
          <select class="form-select" id="customerYearFilter" onchange="filterCustomers()" style="width:140px;">
            <option value="">å…¨æœŸé–“</option>
            <option value="2026">2026å¹´</option>
            <option value="2025">2025å¹´</option>
            <option value="2024">2024å¹´</option>
          </select>
          <button class="btn btn-primary" onclick="showAddCustomerModal()">
            ï¼‹ æ–°è¦ç™»éŒ²
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">é¡§å®¢ä¸€è¦§</div>
              <div class="card-subtitle" id="customerCount">å…¨ 0 ä»¶</div>
            </div>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>æ–½ä¸»å</th>
                  <th>æ•…äººå</th>
                  <th>æ–½è¡Œæ—¥</th>
                  <th>ã‚¨ãƒªã‚¢</th>
                  <th>ãƒ—ãƒ©ãƒ³</th>
                  <th>é‡‘é¡</th>
                  <th>æ‹…å½“</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="customerTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ===== CASES (æ–½è¡Œä»¶æ•°) ===== -->
      <div class="page" id="page-cases">
        <div class="stats-grid">
          <div class="stat-card" style="--stat-color: var(--accent);">
            <div class="stat-label">å¹´é–“æ–½è¡Œä»¶æ•°</div>
            <div class="stat-value">278<span class="stat-unit">ä»¶</span></div>
            <div class="stat-change up">â†‘ 6% å‰å¹´æ¯”</div>
          </div>
          <div class="stat-card" style="--stat-color: var(--info);">
            <div class="stat-label">å¹´é–“å£²ä¸Š</div>
            <div class="stat-value">4.45<span class="stat-unit">å„„å††</span></div>
            <div class="stat-change up">â†‘ 9% å‰å¹´æ¯”</div>
          </div>
          <div class="stat-card" style="--stat-color: var(--success);">
            <div class="stat-label">æœˆé–“å¹³å‡</div>
            <div class="stat-value">23.2<span class="stat-unit">ä»¶</span></div>
            <div class="stat-change">Â± 0%</div>
          </div>
          <div class="stat-card" style="--stat-color: var(--warning);">
            <div class="stat-label">æœ€å¤šæœˆ</div>
            <div class="stat-value">1æœˆ<span class="stat-unit">32ä»¶</span></div>
            <div class="stat-change up">ç¹å¿™æœŸ</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">æœˆåˆ¥æ–½è¡Œä»¶æ•°æ¨ç§»</div>
              <div class="card-subtitle">å¹´åº¦æ¯”è¼ƒ</div>
            </div>
            <div style="display:flex;gap:8px;">
              <button class="btn btn-sm btn-secondary year-btn active" data-year="2025" onclick="switchCaseYear(this)">2025å¹´åº¦</button>
              <button class="btn btn-sm btn-secondary year-btn" data-year="2024" onclick="switchCaseYear(this)">2024å¹´åº¦</button>
            </div>
          </div>
          <div class="bar-chart" id="casesChart" style="height:240px;"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">æœˆåˆ¥è©³ç´°ãƒ‡ãƒ¼ã‚¿</div>
            </div>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>æœˆ</th>
                  <th>æ–½è¡Œä»¶æ•°</th>
                  <th>å£²ä¸Š</th>
                  <th>å¹³å‡å˜ä¾¡</th>
                  <th>å‰æœˆæ¯”</th>
                  <th>å‰å¹´æ¯”</th>
                </tr>
              </thead>
              <tbody id="casesTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ===== SALES (æ‹…å½“è€…åˆ¥å£²ä¸Š) ===== -->
      <div class="page" id="page-sales">
        <div class="stats-grid">
          <div class="stat-card" style="--stat-color: var(--accent);">
            <div class="stat-label">æ‹…å½“è€…æ•°</div>
            <div class="stat-value">6<span class="stat-unit">å</span></div>
          </div>
          <div class="stat-card" style="--stat-color: var(--info);">
            <div class="stat-label">ä»Šæœˆãƒˆãƒƒãƒ—</div>
            <div class="stat-value" style="font-size:1.3rem;">ä½è—¤<span class="stat-unit">ä¸»ä»»</span></div>
            <div class="stat-change up">920ä¸‡å††</div>
          </div>
          <div class="stat-card" style="--stat-color: var(--success);">
            <div class="stat-label">ãƒãƒ¼ãƒ ç›®æ¨™é”æˆç‡</div>
            <div class="stat-value">96<span class="stat-unit">%</span></div>
            <div class="stat-change up">â†‘ æ®‹ã‚Š160ä¸‡å††</div>
          </div>
          <div class="stat-card" style="--stat-color: var(--warning);">
            <div class="stat-label">å¹³å‡ä»¶æ•°/äºº</div>
            <div class="stat-value">4.0<span class="stat-unit">ä»¶/æœˆ</span></div>
          </div>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">æ‹…å½“è€…åˆ¥ å£²ä¸Šã‚°ãƒ©ãƒ•</div>
                <div class="card-subtitle">ä»Šæœˆ</div>
              </div>
            </div>
            <div class="h-bar-chart" id="salesChart"></div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">æ‹…å½“è€…åˆ¥ ä»¶æ•°ã‚°ãƒ©ãƒ•</div>
                <div class="card-subtitle">ä»Šæœˆ</div>
              </div>
            </div>
            <div class="h-bar-chart" id="salesCaseChart"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">æ‹…å½“è€…åˆ¥ è©³ç´°ãƒ‡ãƒ¼ã‚¿</div>
            </div>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>æ‹…å½“è€…</th>
                  <th>å½¹è·</th>
                  <th>æ–½è¡Œä»¶æ•°</th>
                  <th>å£²ä¸Š</th>
                  <th>å¹³å‡å˜ä¾¡</th>
                  <th>ç›®æ¨™</th>
                  <th>é”æˆç‡</th>
                </tr>
              </thead>
              <tbody id="salesTable"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<!-- Customer Detail Modal -->
<div class="modal-overlay" id="customerModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">é¡§å®¢è©³ç´°</div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div id="modalContent"></div>
  </div>
</div>

<script>
// ================================================================
// DATA
// ================================================================

const PLANS = [
  { id: 'family', name: 'å®¶æ—è‘¬ãƒ—ãƒ©ãƒ³', price: 580000, desc: 'å°‘äººæ•°ã§ã®æ¸©ã‹ãªãŠè¦‹é€ã‚Š\nã€œ30åç¨‹åº¦' },
  { id: 'general', name: 'ä¸€èˆ¬è‘¬ãƒ—ãƒ©ãƒ³', price: 1200000, desc: 'ä¼çµ±çš„ãªå½¢å¼ã®è‘¬å„€\n30ã€œ100åç¨‹åº¦' },
  { id: 'premium', name: 'ç‰¹åˆ¥è‘¬ãƒ—ãƒ©ãƒ³', price: 2200000, desc: 'æ ¼å¼ã‚ã‚‹å¤§è¦æ¨¡è‘¬å„€\n100åä»¥ä¸Šå¯¾å¿œ' },
];

const OPTIONS = [
  { id: 'flower', name: 'ç¥­å£‡ç”ŸèŠ±ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—', price: 88000 },
  { id: 'photo', name: 'éºå½±å†™çœŸåŠ å·¥', price: 33000 },
  { id: 'movie', name: 'ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ãƒ ãƒ¼ãƒ“ãƒ¼åˆ¶ä½œ', price: 55000 },
  { id: 'food', name: 'é€šå¤œæŒ¯ã‚‹èˆã„ï¼ˆ30ååˆ†ï¼‰', price: 120000 },
  { id: 'return', name: 'é¦™å…¸è¿”ã—æ‰‹é…ï¼ˆ50å€‹ï¼‰', price: 150000 },
  { id: 'car', name: 'éœŠæŸ©è»Šã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—', price: 44000 },
  { id: 'priest', name: 'åƒ§ä¾¶æ‰‹é…', price: 200000 },
  { id: 'kenpai', name: 'ç¤¼ï¼ˆé éš”çŒ®æ¯ï¼‰ã‚·ã‚¹ãƒ†ãƒ å°å…¥', price: 0 },
];

const STAFF = [
  { name: 'ä½è—¤', role: 'ä¸»ä»»', cases: 6, sales: 9200000, target: 10000000 },
  { name: 'ç”°ä¸­', role: 'ä¸€èˆ¬', cases: 5, sales: 7500000, target: 8000000 },
  { name: 'éˆ´æœ¨', role: 'ä¸»ä»»', cases: 4, sales: 7200000, target: 8000000 },
  { name: 'é«˜æ©‹', role: 'ä¸€èˆ¬', cases: 4, sales: 6400000, target: 7000000 },
  { name: 'ä¼Šè—¤', role: 'æ–°äºº', cases: 3, sales: 4800000, target: 5000000 },
  { name: 'æ¸¡è¾º', role: 'ä¸€èˆ¬', cases: 2, sales: 3300000, target: 5000000 },
];

const MONTHLY_DATA = {
  2025: [
    { m:'4æœˆ', cases:22, sales:3520 }, { m:'5æœˆ', cases:18, sales:2880 },
    { m:'6æœˆ', cases:20, sales:3200 }, { m:'7æœˆ', cases:19, sales:3040 },
    { m:'8æœˆ', cases:21, sales:3360 }, { m:'9æœˆ', cases:25, sales:4000 },
    { m:'10æœˆ', cases:23, sales:3680 }, { m:'11æœˆ', cases:26, sales:4160 },
    { m:'12æœˆ', cases:30, sales:4800 }, { m:'1æœˆ', cases:32, sales:5120 },
    { m:'2æœˆ', cases:24, sales:3840 }, { m:'3æœˆ', cases:0, sales:0 },
  ],
  2024: [
    { m:'4æœˆ', cases:20, sales:3000 }, { m:'5æœˆ', cases:17, sales:2550 },
    { m:'6æœˆ', cases:19, sales:2850 }, { m:'7æœˆ', cases:18, sales:2700 },
    { m:'8æœˆ', cases:20, sales:3000 }, { m:'9æœˆ', cases:22, sales:3300 },
    { m:'10æœˆ', cases:21, sales:3150 }, { m:'11æœˆ', cases:24, sales:3600 },
    { m:'12æœˆ', cases:28, sales:4200 }, { m:'1æœˆ', cases:30, sales:4500 },
    { m:'2æœˆ', cases:22, sales:3300 }, { m:'3æœˆ', cases:21, sales:3150 },
  ],
};

const CUSTOMERS = [
  { id:1, client:'å±±ç”° å¤ªéƒ', deceased:'å±±ç”° èŠ±å­', date:'2026-01-28', area:'æ±äº¬éƒ½', plan:'å®¶æ—è‘¬', amount:710000, staff:'ä½è—¤', phone:'090-1234-5678', address:'æ±äº¬éƒ½ä¸–ç”°è°·åŒºæˆåŸ1-2-3', relationship:'é…å¶è€…', note:'å®¶æ—è‘¬ã€‚å‚åˆ—è€…25åã€‚ç”ŸèŠ±ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—å¸Œæœ›ã€‚' },
  { id:2, client:'ä½ã€…æœ¨ ä¸€éƒ', deceased:'ä½ã€…æœ¨ ç¯€å­', date:'2026-01-25', area:'ç¥å¥ˆå·çœŒ', plan:'ä¸€èˆ¬è‘¬', amount:1450000, staff:'ç”°ä¸­', phone:'080-2345-6789', address:'æ¨ªæµœå¸‚é’è‘‰åŒºã‚ã–ã¿é‡2-3-4', relationship:'é•·ç”·', note:'ä¸€èˆ¬è‘¬ã€‚å‚åˆ—è€…ç´„80åã€‚ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ãƒ ãƒ¼ãƒ“ãƒ¼å¸Œæœ›ã€‚' },
  { id:3, client:'ä¸­æ‘ å¥äºŒ', deceased:'ä¸­æ‘ æ­£é›„', date:'2026-01-22', area:'æ±äº¬éƒ½', plan:'ç‰¹åˆ¥è‘¬', amount:2500000, staff:'éˆ´æœ¨', phone:'070-3456-7890', address:'æ±äº¬éƒ½æ¸¯åŒºèµ¤å‚3-4-5', relationship:'é•·ç”·', note:'ä¼æ¥­è‘¬ã«è¿‘ã„è¦æ¨¡ã€‚ç¤¾è‘¬å¯¾å¿œå¿…è¦ã€‚å‚åˆ—è€…200åä»¥ä¸Šã€‚' },
  { id:4, client:'å°æ— ç¾å’²', deceased:'å°æ— å‹', date:'2026-01-18', area:'åŸ¼ç‰çœŒ', plan:'å®¶æ—è‘¬', amount:630000, staff:'é«˜æ©‹', phone:'090-4567-8901', address:'ã•ã„ãŸã¾å¸‚æµ¦å’ŒåŒºä»²ç”º4-5-6', relationship:'é•·å¥³', note:'ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªå®¶æ—è‘¬ã‚’å¸Œæœ›ã€‚' },
  { id:5, client:'åŠ è—¤ èª ', deceased:'åŠ è—¤ ãƒãƒ«', date:'2026-01-15', area:'åƒè‘‰çœŒ', plan:'ä¸€èˆ¬è‘¬', amount:1350000, staff:'ä½è—¤', phone:'080-5678-9012', address:'èˆ¹æ©‹å¸‚æœ¬ç”º5-6-7', relationship:'é•·ç”·', note:'é€šå¤œæŒ¯ã‚‹èˆã„50ååˆ†ã€‚é¦™å…¸è¿”ã—æ‰‹é…ã€‚' },
  { id:6, client:'å‰ç”° ä¿®', deceased:'å‰ç”° ç¾ä»£å­', date:'2026-01-10', area:'æ±äº¬éƒ½', plan:'å®¶æ—è‘¬', amount:680000, staff:'ä¼Šè—¤', phone:'070-6789-0123', address:'æ±äº¬éƒ½æ‰ä¸¦åŒºé«˜å††å¯ºå—6-7-8', relationship:'å¤«', note:'å°‘äººæ•°ã€‚éºå½±å†™çœŸåŠ å·¥å¸Œæœ›ã€‚' },
  { id:7, client:'æ¾æœ¬ éš†', deceased:'æ¾æœ¬ ä¿¡ä¸€', date:'2025-12-28', area:'ç¥å¥ˆå·çœŒ', plan:'ä¸€èˆ¬è‘¬', amount:1280000, staff:'ç”°ä¸­', phone:'090-7890-1234', address:'å·å´å¸‚ä¸­åŸåŒºä¸Šå°ç”°ä¸­7-8-9', relationship:'é•·ç”·', note:'å¹´æœ«å¯¾å¿œã€‚éœŠæŸ©è»Šã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã€‚' },
  { id:8, client:'äº•ä¸Š ç›´ç¾', deceased:'äº•ä¸Š ä¸‰éƒ', date:'2025-12-20', area:'æ±äº¬éƒ½', plan:'ç‰¹åˆ¥è‘¬', amount:2350000, staff:'éˆ´æœ¨', phone:'080-8901-2345', address:'æ±äº¬éƒ½æ–‡äº¬åŒºæœ¬éƒ·8-9-10', relationship:'é•·å¥³', note:'å¤§è¦æ¨¡ã€‚åƒ§ä¾¶æ‰‹é…è¾¼ã¿ã€‚' },
  { id:9, client:'æœ¨æ‘ æµ©äºŒ', deceased:'æœ¨æ‘ ãƒ¨ã‚·', date:'2025-12-15', area:'åŸ¼ç‰çœŒ', plan:'å®¶æ—è‘¬', amount:620000, staff:'æ¸¡è¾º', phone:'070-9012-3456', address:'å·å£å¸‚æ „ç”º9-10-11', relationship:'é•·ç”·', note:'ã‚·ãƒ³ãƒ—ãƒ«ãªãŠè¦‹é€ã‚Šã‚’å¸Œæœ›ã€‚' },
  { id:10, client:'æ— æ­£æ¨¹', deceased:'æ— åƒä»£', date:'2025-12-10', area:'åƒè‘‰çœŒ', plan:'ä¸€èˆ¬è‘¬', amount:1150000, staff:'é«˜æ©‹', phone:'090-0123-4567', address:'æŸå¸‚æŸ10-11-12', relationship:'é•·ç”·', note:'é€šå¤œæŒ¯ã‚‹èˆã„30åã€‚' },
  { id:11, client:'æ–‰è—¤ è£•å­', deceased:'æ–‰è—¤ æ­¦ç”·', date:'2025-12-05', area:'æ±äº¬éƒ½', plan:'å®¶æ—è‘¬', amount:750000, staff:'ä½è—¤', phone:'080-1111-2222', address:'æ±äº¬éƒ½ä¸­é‡åŒºæ–°äº•1-1-1', relationship:'é…å¶è€…', note:'ç”ŸèŠ±ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã€‚ãƒ ãƒ¼ãƒ“ãƒ¼åˆ¶ä½œã€‚' },
  { id:12, client:'çŸ³å· å¤§ä»‹', deceased:'çŸ³å· ã‚­ãƒ¨', date:'2025-11-28', area:'ç¥å¥ˆå·çœŒ', plan:'ä¸€èˆ¬è‘¬', amount:1400000, staff:'ç”°ä¸­', phone:'070-2222-3333', address:'æ¨ªæµœå¸‚è¥¿åŒºã¿ãªã¨ã¿ã‚‰ã„2-2-2', relationship:'é•·ç”·', note:'å‚åˆ—è€…70åç¨‹åº¦ã€‚' },
];

// ================================================================
// STATE
// ================================================================

let selectedPlan = null;
let optionStates = {};
OPTIONS.forEach(o => { optionStates[o.id] = o.id === 'kenpai'; }); // ç¤¼ is ON by default

let currentCaseYear = '2025';

// ================================================================
// NAVIGATION
// ================================================================

const PAGE_TITLES = {
  dashboard: ['ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', 'çµŒå–¶çŠ¶æ³ã‚’ã²ã¨ç›®ã§æŠŠæ¡'],
  estimate: ['è¦‹ç©ä½œæˆ', 'ãƒ—ãƒ©ãƒ³é¸æŠ â†’ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ â†’ è‡ªå‹•ç®—å‡º'],
  customer: ['é¡§å®¢ç®¡ç†', 'æ–½ä¸»ãƒ»æ•…äººã®ä¸€å…ƒç®¡ç†'],
  cases: ['æ–½è¡Œä»¶æ•°', 'æœˆåˆ¥ãƒ»å¹´åˆ¥ã®æ¨ç§»åˆ†æ'],
  sales: ['æ‹…å½“è€…åˆ¥å£²ä¸Š', 'å€‹äººãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é›†è¨ˆ'],
};

document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', function () {
    const page = this.dataset.page;
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    this.classList.add('active');
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + page).classList.add('active');
    const [title, sub] = PAGE_TITLES[page] || ['', ''];
    document.getElementById('pageTitle').textContent = title;
    document.getElementById('pageSubtitle').textContent = sub;
    // Close mobile sidebar
    document.querySelector('.sidebar').classList.remove('open');
  });
});

// ================================================================
// FORMATTERS
// ================================================================

function yen(n) {
  return 'Â¥' + n.toLocaleString();
}

function manyen(n) {
  return (n / 10000).toFixed(0) + 'ä¸‡å††';
}

// ================================================================
// DASHBOARD
// ================================================================

function renderDashboard() {
  // Bar chart
  const data = MONTHLY_DATA[2025];
  const maxCases = Math.max(...data.map(d => d.cases));
  const chartEl = document.getElementById('dashboardChart');
  chartEl.innerHTML = data.map(d => {
    const h = d.cases > 0 ? (d.cases / maxCases * 100) : 0;
    return `<div class="bar-col">
      <div class="bar-value">${d.cases || '-'}</div>
      <div class="bar" style="height:${h}%"></div>
      <div class="bar-label">${d.m}</div>
    </div>`;
  }).join('');

  // Ranking
  const sorted = [...STAFF].sort((a, b) => b.sales - a.sales);
  const maxSales = sorted[0].sales;
  document.getElementById('dashboardRanking').innerHTML = sorted.map(s => {
    const pct = (s.sales / maxSales * 100).toFixed(0);
    return `<div class="h-bar-row">
      <div class="h-bar-name">${s.name}</div>
      <div class="h-bar-track">
        <div class="h-bar-fill" style="width:${pct}%">
          <span class="h-bar-val">${s.cases}ä»¶</span>
        </div>
      </div>
      <div class="h-bar-amount">${manyen(s.sales)}</div>
    </div>`;
  }).join('');

  // Recent cases table
  const recent = [...CUSTOMERS].sort((a, b) => b.date.localeCompare(a.date)).slice(0, 7);
  document.getElementById('recentCasesTable').innerHTML = recent.map(c => {
    const statusTag = new Date(c.date) > new Date() ?
      '<span class="tag tag-warning">äºˆå®š</span>' :
      '<span class="tag tag-success">å®Œäº†</span>';
    return `<tr>
      <td>${c.date}</td>
      <td style="color:var(--text-primary);font-weight:500;">${c.deceased}</td>
      <td>${c.client}</td>
      <td><span class="tag tag-accent">${c.plan}</span></td>
      <td style="font-weight:600;color:var(--text-primary);">${yen(c.amount)}</td>
      <td>${c.staff}</td>
      <td>${statusTag}</td>
    </tr>`;
  }).join('');
}

// ================================================================
// ESTIMATE
// ================================================================

function renderEstimate() {
  // Plans
  document.getElementById('planCards').innerHTML = PLANS.map(p => {
    const sel = selectedPlan === p.id ? 'selected' : '';
    return `<div class="plan-card ${sel}" onclick="selectPlan('${p.id}')">
      <div class="plan-name">${p.name}</div>
      <div class="plan-price">${yen(p.price)}<span class="plan-price-unit">ï¼ˆç¨è¾¼ï¼‰</span></div>
      <div class="plan-desc">${p.desc.replace('\n', '<br>')}</div>
    </div>`;
  }).join('');

  // Options
  document.getElementById('optionList').innerHTML = OPTIONS.map(o => {
    const on = optionStates[o.id] ? 'on' : '';
    const priceText = o.price === 0 ? 'ç„¡æ–™' : '+' + yen(o.price);
    return `<div class="option-item ${on}" onclick="toggleOption('${o.id}')">
      <div class="option-left">
        <div class="option-toggle"></div>
        <div class="option-name">${o.name}</div>
      </div>
      <div class="option-price">${priceText}</div>
    </div>`;
  }).join('');

  updateSummary();
}

function selectPlan(id) {
  selectedPlan = id;
  renderEstimate();
}

function toggleOption(id) {
  optionStates[id] = !optionStates[id];
  renderEstimate();
}

function updateSummary() {
  const items = [];
  let subtotal = 0;

  if (selectedPlan) {
    const plan = PLANS.find(p => p.id === selectedPlan);
    items.push({ name: plan.name, price: plan.price });
    subtotal += plan.price;
  }

  OPTIONS.forEach(o => {
    if (optionStates[o.id] && o.price > 0) {
      items.push({ name: o.name, price: o.price });
      subtotal += o.price;
    }
    if (optionStates[o.id] && o.price === 0) {
      items.push({ name: o.name + 'ï¼ˆç„¡æ–™ï¼‰', price: 0 });
    }
  });

  document.getElementById('summaryItems').innerHTML = items.length > 0 ?
    items.map(i => `<div class="summary-item">
      <span class="summary-item-name">${i.name}</span>
      <span class="summary-item-price">${i.price > 0 ? yen(i.price) : 'Â¥0'}</span>
    </div>`).join('') :
    '<div style="color:var(--text-muted);font-size:0.82rem;text-align:center;padding:12px 0;">ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</div>';

  const tax = Math.round(subtotal * 0.1);
  const total = subtotal + tax;
  document.getElementById('summaryTotal').textContent = yen(total);
  document.getElementById('summaryTax').textContent = `ï¼ˆç¨æŠœ: ${yen(subtotal)}  /  æ¶ˆè²»ç¨: ${yen(tax)}ï¼‰`;
}

function saveEstimate() {
  if (!selectedPlan) {
    alert('ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
    return;
  }
  alert('âœ… è¦‹ç©ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼\n\næ–½ä¸»: ' + (document.getElementById('estClientName').value || 'æœªå…¥åŠ›') + '\næ•…äºº: ' + (document.getElementById('estDeceasedName').value || 'æœªå…¥åŠ›'));
}

function printEstimate() {
  if (!selectedPlan) {
    alert('ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
    return;
  }
  alert('ğŸ–¨ å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™ï¼ˆãƒ‡ãƒ¢ï¼‰');
}

// ================================================================
// CUSTOMER
// ================================================================

function renderCustomers(list) {
  const tbl = document.getElementById('customerTable');
  document.getElementById('customerCount').textContent = 'å…¨ ' + list.length + ' ä»¶';
  tbl.innerHTML = list.map(c => `<tr>
    <td style="color:var(--text-primary);font-weight:500;">${c.client}</td>
    <td>${c.deceased}</td>
    <td>${c.date}</td>
    <td>${c.area}</td>
    <td><span class="tag tag-accent">${c.plan}</span></td>
    <td style="font-weight:600;color:var(--text-primary);">${yen(c.amount)}</td>
    <td>${c.staff}</td>
    <td><button class="btn-icon" onclick="showCustomerDetail(${c.id})" title="è©³ç´°">ğŸ“‹</button></td>
  </tr>`).join('');
}

function filterCustomers() {
  const q = document.getElementById('customerSearch').value.toLowerCase();
  const area = document.getElementById('customerAreaFilter').value;
  const year = document.getElementById('customerYearFilter').value;

  let filtered = CUSTOMERS.filter(c => {
    const matchQ = !q || c.client.toLowerCase().includes(q) || c.deceased.toLowerCase().includes(q);
    const matchArea = !area || c.area === area;
    const matchYear = !year || c.date.startsWith(year);
    return matchQ && matchArea && matchYear;
  });

  renderCustomers(filtered);
}

function showCustomerDetail(id) {
  const c = CUSTOMERS.find(x => x.id === id);
  if (!c) return;
  document.getElementById('modalTitle').textContent = c.deceased + ' æ§˜ â€” é¡§å®¢è©³ç´°';
  document.getElementById('modalContent').innerHTML = `
    <div class="detail-grid">
      <div class="detail-item"><div class="detail-label">æ–½ä¸»å</div><div class="detail-value">${c.client}</div></div>
      <div class="detail-item"><div class="detail-label">æ•…äººå</div><div class="detail-value">${c.deceased}</div></div>
      <div class="detail-item"><div class="detail-label">æ–½è¡Œæ—¥</div><div class="detail-value">${c.date}</div></div>
      <div class="detail-item"><div class="detail-label">ã‚¨ãƒªã‚¢</div><div class="detail-value">${c.area}</div></div>
      <div class="detail-item"><div class="detail-label">é›»è©±ç•ªå·</div><div class="detail-value">${c.phone}</div></div>
      <div class="detail-item"><div class="detail-label">ãƒ—ãƒ©ãƒ³</div><div class="detail-value">${c.plan}</div></div>
      <div class="detail-item"><div class="detail-label">é‡‘é¡</div><div class="detail-value" style="color:var(--accent);font-size:1.1rem;">${yen(c.amount)}</div></div>
      <div class="detail-item"><div class="detail-label">æ‹…å½“</div><div class="detail-value">${c.staff}</div></div>
      <div class="detail-item detail-full"><div class="detail-label">ä½æ‰€</div><div class="detail-value">${c.address}</div></div>
      <div class="detail-item"><div class="detail-label">ç¶šæŸ„</div><div class="detail-value">${c.relationship}</div></div>
      <div class="detail-item detail-full"><div class="detail-label">å‚™è€ƒãƒ»æ³¨æ„äº‹é …</div><div class="detail-value">${c.note}</div></div>
    </div>
  `;
  document.getElementById('customerModal').classList.add('show');
}

function showAddCustomerModal() {
  alert('æ–°è¦é¡§å®¢ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã—ã¾ã™ï¼ˆãƒ‡ãƒ¢ï¼‰');
}

function closeModal() {
  document.getElementById('customerModal').classList.remove('show');
}

document.getElementById('customerModal').addEventListener('click', function (e) {
  if (e.target === this) closeModal();
});

// ================================================================
// CASES (æ–½è¡Œä»¶æ•°)
// ================================================================

function renderCases() {
  const data = MONTHLY_DATA[currentCaseYear];
  const prevData = MONTHLY_DATA[currentCaseYear === '2025' ? '2024' : '2025'];
  const maxCases = Math.max(...data.map(d => d.cases), 1);

  document.getElementById('casesChart').innerHTML = data.map(d => {
    const h = d.cases > 0 ? (d.cases / maxCases * 100) : 0;
    return `<div class="bar-col">
      <div class="bar-value">${d.cases || '-'}</div>
      <div class="bar" style="height:${h}%"></div>
      <div class="bar-label">${d.m}</div>
    </div>`;
  }).join('');

  document.getElementById('casesTable').innerHTML = data.map((d, i) => {
    if (d.cases === 0) return '';
    const avg = d.cases > 0 ? Math.round(d.sales / d.cases) : 0;
    const prevMonth = i > 0 && data[i - 1].cases > 0 ?
      ((d.cases - data[i - 1].cases) / data[i - 1].cases * 100).toFixed(1) : '-';
    const prevYear = prevData[i] && prevData[i].cases > 0 ?
      ((d.cases - prevData[i].cases) / prevData[i].cases * 100).toFixed(1) : '-';
    const pmClass = prevMonth > 0 ? 'up' : prevMonth < 0 ? 'down' : '';
    const pyClass = prevYear > 0 ? 'up' : prevYear < 0 ? 'down' : '';
    return `<tr>
      <td style="font-weight:500;color:var(--text-primary);">${d.m}</td>
      <td>${d.cases}ä»¶</td>
      <td>${d.sales.toLocaleString()}ä¸‡å††</td>
      <td>${avg}ä¸‡å††</td>
      <td><span class="stat-change ${pmClass}">${prevMonth === '-' ? '-' : (prevMonth > 0 ? 'â†‘' : 'â†“') + ' ' + Math.abs(prevMonth) + '%'}</span></td>
      <td><span class="stat-change ${pyClass}">${prevYear === '-' ? '-' : (prevYear > 0 ? 'â†‘' : 'â†“') + ' ' + Math.abs(prevYear) + '%'}</span></td>
    </tr>`;
  }).join('');
}

function switchCaseYear(btn) {
  document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  currentCaseYear = btn.dataset.year;
  renderCases();
}

// ================================================================
// SALES (æ‹…å½“è€…åˆ¥)
// ================================================================

function renderSales() {
  const sorted = [...STAFF].sort((a, b) => b.sales - a.sales);
  const maxSales = sorted[0].sales;
  const maxCases = Math.max(...sorted.map(s => s.cases));

  // Sales chart
  document.getElementById('salesChart').innerHTML = sorted.map(s => {
    const pct = (s.sales / maxSales * 100).toFixed(0);
    return `<div class="h-bar-row">
      <div class="h-bar-name">${s.name}</div>
      <div class="h-bar-track">
        <div class="h-bar-fill" style="width:${pct}%">
          <span class="h-bar-val">${manyen(s.sales)}</span>
        </div>
      </div>
      <div class="h-bar-amount">${manyen(s.sales)}</div>
    </div>`;
  }).join('');

  // Cases chart
  const cSorted = [...STAFF].sort((a, b) => b.cases - a.cases);
  document.getElementById('salesCaseChart').innerHTML = cSorted.map(s => {
    const pct = (s.cases / maxCases * 100).toFixed(0);
    return `<div class="h-bar-row">
      <div class="h-bar-name">${s.name}</div>
      <div class="h-bar-track">
        <div class="h-bar-fill" style="width:${pct}%;background:linear-gradient(90deg,#3a6fad,var(--info));">
          <span class="h-bar-val">${s.cases}ä»¶</span>
        </div>
      </div>
      <div class="h-bar-amount">${s.cases}ä»¶</div>
    </div>`;
  }).join('');

  // Table
  document.getElementById('salesTable').innerHTML = sorted.map(s => {
    const avg = s.cases > 0 ? Math.round(s.sales / s.cases) : 0;
    const rate = (s.sales / s.target * 100).toFixed(0);
    const rateClass = rate >= 100 ? 'tag-success' : rate >= 80 ? 'tag-warning' : 'tag-danger';
    return `<tr>
      <td style="color:var(--text-primary);font-weight:500;">${s.name}</td>
      <td><span class="tag tag-info">${s.role}</span></td>
      <td>${s.cases}ä»¶</td>
      <td style="font-weight:600;color:var(--text-primary);">${manyen(s.sales)}</td>
      <td>${manyen(avg)}</td>
      <td>${manyen(s.target)}</td>
      <td><span class="tag ${rateClass}">${rate}%</span></td>
    </tr>`;
  }).join('');
}

// ================================================================
// INIT
// ================================================================

function init() {
  renderDashboard();
  renderEstimate();
  renderCustomers(CUSTOMERS);
  renderCases();
  renderSales();

  // Animate bars on load
  setTimeout(() => {
    document.querySelectorAll('.bar, .h-bar-fill').forEach(el => {
      el.style.transition = 'width 1s cubic-bezier(0.34,1.56,0.64,1), height 0.8s cubic-bezier(0.34,1.56,0.64,1)';
    });
  }, 100);
}

init();
</script>
</body>
</html>