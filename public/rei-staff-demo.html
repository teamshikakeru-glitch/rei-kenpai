<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>ç¤¼ã‚«ã‚¹ã‚¿ãƒ  â€” ã‚¹ã‚¿ãƒƒãƒ•</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

:root {
  --bg: #0f1117;
  --bg2: #181b25;
  --bg3: #1e2230;
  --bg4: #252a3a;
  --border: #2a2f42;
  --border2: #353b52;
  --t1: #e8eaf0;
  --t2: #9399ad;
  --t3: #5f6580;
  --gold: #c9a96e;
  --gold-l: #dfc48e;
  --gold-d: #a6863f;
  --gold-g: rgba(201,169,110,0.12);
  --green: #5cb87a;
  --red: #e05c5c;
  --blue: #5c9de0;
  --orange: #e0a85c;
  --r: 12px;
  --rs: 8px;
  --rl: 18px;
  --ease: cubic-bezier(0.4, 0, 0.2, 1);
  --safe-b: env(safe-area-inset-bottom, 0px);
}

html { font-size: 15px; -webkit-tap-highlight-color: transparent; }

body {
  font-family: 'Zen Kaku Gothic New', 'Noto Sans JP', sans-serif;
  background: var(--bg);
  color: var(--t1);
  min-height: 100vh;
  min-height: 100dvh;
  overflow-x: hidden;
  padding-bottom: calc(72px + var(--safe-b));
}

/* ============ TOP HEADER ============ */
.top-bar {
  position: sticky;
  top: 0;
  z-index: 80;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  padding: 14px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

.top-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.top-logo {
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, var(--gold), var(--gold-d));
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 700;
  color: #0f1117;
}

.top-info {
  display: flex;
  flex-direction: column;
}

.top-company {
  font-size: 0.72rem;
  color: var(--t3);
  letter-spacing: 0.5px;
}

.top-user {
  font-size: 0.88rem;
  font-weight: 600;
  color: var(--t1);
}

.top-right {
  display: flex;
  align-items: center;
  gap: 10px;
}

.notif-btn {
  width: 36px;
  height: 36px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  cursor: pointer;
  position: relative;
  color: var(--t2);
  transition: all 0.2s var(--ease);
}

.notif-btn:active { transform: scale(0.92); }

.notif-badge {
  position: absolute;
  top: -2px;
  right: -2px;
  width: 16px;
  height: 16px;
  background: var(--red);
  border-radius: 50%;
  font-size: 0.6rem;
  font-weight: 700;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--bg2);
}

/* ============ PAGES ============ */
.page {
  display: none;
  padding: 16px;
  animation: pageIn 0.3s var(--ease);
}

.page.active { display: block; }

@keyframes pageIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ============ BOTTOM NAV ============ */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 90;
  background: var(--bg2);
  border-top: 1px solid var(--border);
  display: flex;
  padding: 6px 8px calc(6px + var(--safe-b));
  gap: 4px;
}

.nav-tab {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  padding: 8px 4px;
  border-radius: var(--rs);
  cursor: pointer;
  transition: all 0.2s var(--ease);
  border: none;
  background: none;
  -webkit-appearance: none;
}

.nav-tab:active { transform: scale(0.92); }

.nav-tab-icon {
  font-size: 1.2rem;
  transition: transform 0.2s var(--ease);
}

.nav-tab-label {
  font-size: 0.62rem;
  font-weight: 500;
  color: var(--t3);
  letter-spacing: 0.3px;
  transition: color 0.2s var(--ease);
  font-family: inherit;
}

.nav-tab.active {
  background: var(--gold-g);
}

.nav-tab.active .nav-tab-icon {
  transform: scale(1.15);
}

.nav-tab.active .nav-tab-label {
  color: var(--gold);
  font-weight: 600;
}

/* ============ SECTION HEADER ============ */
.sec-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 14px;
}

.sec-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--t1);
  letter-spacing: 0.3px;
}

.sec-sub {
  font-size: 0.72rem;
  color: var(--t3);
  margin-top: 2px;
}

/* ============ CARDS ============ */
.card {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: var(--rl);
  padding: 18px;
  margin-bottom: 14px;
  transition: border-color 0.2s var(--ease);
}

.card:active { border-color: var(--border2); }

.card-sm {
  padding: 14px;
  border-radius: var(--r);
}

/* ============ STAT ROW ============ */
.stat-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 16px;
}

.stat-box {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 14px;
  position: relative;
  overflow: hidden;
}

.stat-box::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2.5px;
  background: var(--sc, var(--gold));
}

.stat-label {
  font-size: 0.68rem;
  color: var(--t3);
  font-weight: 500;
  letter-spacing: 0.5px;
}

.stat-val {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--t1);
  margin-top: 4px;
  line-height: 1;
}

.stat-unit {
  font-size: 0.72rem;
  font-weight: 400;
  color: var(--t2);
}

/* ============ CASE LIST ============ */
.case-item {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 16px;
  margin-bottom: 10px;
  cursor: pointer;
  transition: all 0.2s var(--ease);
  display: flex;
  align-items: center;
  gap: 14px;
}

.case-item:active {
  background: var(--bg4);
  transform: scale(0.98);
}

.case-icon {
  width: 44px;
  height: 44px;
  background: var(--gold-g);
  border-radius: var(--r);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  flex-shrink: 0;
}

.case-body {
  flex: 1;
  min-width: 0;
}

.case-name {
  font-size: 0.92rem;
  font-weight: 600;
  color: var(--t1);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.case-meta {
  font-size: 0.72rem;
  color: var(--t3);
  margin-top: 3px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.case-right {
  text-align: right;
  flex-shrink: 0;
}

.case-amount {
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--gold);
}

.case-date {
  font-size: 0.68rem;
  color: var(--t3);
  margin-top: 3px;
}

/* ============ TAGS ============ */
.tag {
  display: inline-flex;
  align-items: center;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.65rem;
  font-weight: 600;
  letter-spacing: 0.3px;
}

.tag-green { background: rgba(92,184,122,0.15); color: var(--green); }
.tag-orange { background: rgba(224,168,92,0.15); color: var(--orange); }
.tag-blue { background: rgba(92,157,224,0.15); color: var(--blue); }
.tag-red { background: rgba(224,92,92,0.15); color: var(--red); }
.tag-gold { background: var(--gold-g); color: var(--gold); }

/* ============ SCHEDULE ============ */
.sched-item {
  display: flex;
  gap: 14px;
  padding: 14px 0;
  border-bottom: 1px solid rgba(42,47,66,0.5);
}

.sched-item:last-child { border-bottom: none; }

.sched-time {
  width: 52px;
  text-align: center;
  flex-shrink: 0;
}

.sched-hour {
  font-size: 0.92rem;
  font-weight: 700;
  color: var(--t1);
}

.sched-min {
  font-size: 0.68rem;
  color: var(--t3);
}

.sched-line {
  width: 3px;
  background: var(--sl, var(--gold));
  border-radius: 2px;
  flex-shrink: 0;
}

.sched-body {
  flex: 1;
}

.sched-title {
  font-size: 0.88rem;
  font-weight: 600;
  color: var(--t1);
}

.sched-detail {
  font-size: 0.75rem;
  color: var(--t3);
  margin-top: 3px;
  line-height: 1.5;
}

.sched-tag {
  margin-top: 6px;
}

/* ============ BUTTONS ============ */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 20px;
  border-radius: var(--r);
  font-size: 0.88rem;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid transparent;
  font-family: inherit;
  transition: all 0.2s var(--ease);
  letter-spacing: 0.3px;
  width: 100%;
}

.btn:active { transform: scale(0.97); }

.btn-gold {
  background: linear-gradient(135deg, var(--gold), var(--gold-d));
  color: #0f1117;
}

.btn-outline {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--t2);
}

.btn-outline:active {
  border-color: var(--gold);
  color: var(--gold);
}

.btn-sm {
  padding: 8px 14px;
  font-size: 0.78rem;
  width: auto;
  border-radius: var(--rs);
}

/* ============ FORMS ============ */
.form-group {
  margin-bottom: 14px;
}

.form-label {
  display: block;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--t2);
  margin-bottom: 6px;
  letter-spacing: 0.3px;
}

.form-input, .form-select, .form-textarea {
  width: 100%;
  padding: 12px 14px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--rs);
  color: var(--t1);
  font-size: 16px; /* prevent iOS zoom */
  font-family: inherit;
  transition: border-color 0.2s var(--ease);
  outline: none;
  -webkit-appearance: none;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
  border-color: var(--gold);
}

.form-select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239399ad' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 36px;
}

.form-textarea {
  resize: vertical;
  min-height: 80px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

/* ============ PLAN SELECTOR (MOBILE) ============ */
.plan-scroll {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 8px;
  margin: 0 -16px;
  padding-left: 16px;
  padding-right: 16px;
}

.plan-scroll::-webkit-scrollbar { display: none; }

.plan-chip {
  flex: 0 0 auto;
  width: calc(50vw - 24px);
  max-width: 200px;
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: var(--r);
  padding: 16px;
  cursor: pointer;
  scroll-snap-align: start;
  transition: all 0.2s var(--ease);
  text-align: center;
}

.plan-chip:active { transform: scale(0.96); }

.plan-chip.selected {
  border-color: var(--gold);
  background: var(--gold-g);
}

.plan-chip-name {
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--t1);
  margin-bottom: 4px;
}

.plan-chip-price {
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--gold);
}

.plan-chip-desc {
  font-size: 0.65rem;
  color: var(--t3);
  margin-top: 4px;
  line-height: 1.4;
}

/* ============ OPTION TOGGLE (MOBILE) ============ */
.opt-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--rs);
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.2s var(--ease);
  -webkit-user-select: none;
  user-select: none;
}

.opt-item:active { background: var(--bg4); }

.opt-item.on {
  border-color: var(--gold);
  background: var(--gold-g);
}

.opt-left {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
  min-width: 0;
}

.opt-switch {
  width: 40px;
  height: 22px;
  background: var(--border);
  border-radius: 11px;
  position: relative;
  transition: background 0.25s var(--ease);
  flex-shrink: 0;
}

.opt-switch::after {
  content: '';
  position: absolute;
  width: 18px;
  height: 18px;
  background: var(--t3);
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: all 0.25s var(--ease);
}

.opt-item.on .opt-switch {
  background: var(--gold);
}

.opt-item.on .opt-switch::after {
  left: 20px;
  background: #0f1117;
}

.opt-name {
  font-size: 0.85rem;
  color: var(--t2);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.opt-item.on .opt-name { color: var(--t1); }

.opt-price {
  font-size: 0.78rem;
  font-weight: 600;
  color: var(--t3);
  white-space: nowrap;
  flex-shrink: 0;
  margin-left: 8px;
}

.opt-item.on .opt-price { color: var(--gold); }

/* ============ SUMMARY BAR (MOBILE) ============ */
.summary-bar {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: var(--rl);
  padding: 18px;
  margin-top: 16px;
}

.summary-line {
  display: flex;
  justify-content: space-between;
  font-size: 0.82rem;
  color: var(--t2);
  padding: 4px 0;
}

.summary-line-val { color: var(--t1); font-weight: 500; }

.summary-divider {
  border: none;
  border-top: 1px solid var(--border);
  margin: 12px 0;
}

.summary-total {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
}

.summary-total-label {
  font-size: 0.9rem;
  font-weight: 600;
}

.summary-total-val {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--gold);
}

.summary-tax {
  text-align: right;
  font-size: 0.68rem;
  color: var(--t3);
  margin-top: 3px;
}

/* ============ MODAL / SHEET ============ */
.sheet-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  z-index: 200;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.sheet-overlay.show {
  display: block;
  animation: fadeIn 0.2s var(--ease);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.sheet {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 210;
  background: var(--bg3);
  border-radius: 20px 20px 0 0;
  padding: 20px 20px calc(20px + var(--safe-b));
  max-height: 85vh;
  overflow-y: auto;
  display: none;
  transform: translateY(100%);
  transition: transform 0.35s var(--ease);
}

.sheet.show {
  display: block;
  transform: translateY(0);
  animation: sheetUp 0.35s var(--ease);
}

@keyframes sheetUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

.sheet-handle {
  width: 36px;
  height: 4px;
  background: var(--border2);
  border-radius: 2px;
  margin: 0 auto 16px;
}

.sheet-title {
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--t1);
  margin-bottom: 18px;
}

/* ============ DETAIL SHEET ============ */
.detail-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.detail-box {
  background: var(--bg);
  border-radius: var(--rs);
  padding: 12px;
}

.detail-label {
  font-size: 0.65rem;
  color: var(--t3);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 3px;
}

.detail-val {
  font-size: 0.88rem;
  color: var(--t1);
  font-weight: 500;
}

.detail-full { grid-column: 1 / -1; }

/* ============ EMPTY STATE ============ */
.empty {
  text-align: center;
  padding: 40px 20px;
  color: var(--t3);
}

.empty-icon {
  font-size: 2.5rem;
  margin-bottom: 12px;
  opacity: 0.5;
}

.empty-text {
  font-size: 0.88rem;
  line-height: 1.6;
}

/* ============ FILTER CHIPS ============ */
.filter-row {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  margin-bottom: 14px;
  padding-bottom: 4px;
  -webkit-overflow-scrolling: touch;
}

.filter-row::-webkit-scrollbar { display: none; }

.filter-chip {
  flex: 0 0 auto;
  padding: 7px 14px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--bg3);
  color: var(--t2);
  transition: all 0.2s var(--ease);
  font-family: inherit;
  white-space: nowrap;
}

.filter-chip:active { transform: scale(0.94); }

.filter-chip.active {
  background: var(--gold-g);
  border-color: var(--gold);
  color: var(--gold);
  font-weight: 600;
}

/* ============ SEARCH ============ */
.search-wrap {
  position: relative;
  margin-bottom: 14px;
}

.search-wrap input {
  padding-left: 38px;
}

.search-icon {
  position: absolute;
  left: 13px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--t3);
  font-size: 0.9rem;
  pointer-events: none;
}

/* ============ FAB ============ */
.fab {
  position: fixed;
  bottom: calc(84px + var(--safe-b));
  right: 20px;
  z-index: 70;
  width: 52px;
  height: 52px;
  background: linear-gradient(135deg, var(--gold), var(--gold-d));
  border-radius: 50%;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: #0f1117;
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(201,169,110,0.35);
  transition: all 0.2s var(--ease);
}

.fab:active { transform: scale(0.88); }

.fab.hidden { display: none; }

/* ============ TOAST ============ */
.toast {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%) translateY(-20px);
  background: var(--bg3);
  border: 1px solid var(--green);
  border-radius: var(--r);
  padding: 12px 20px;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--green);
  z-index: 300;
  opacity: 0;
  transition: all 0.3s var(--ease);
  pointer-events: none;
  white-space: nowrap;
}

.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* ============ SCROLLBAR ============ */
::-webkit-scrollbar { width: 0; height: 0; }
</style>
</head>
<body>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Top Bar -->
<header class="top-bar">
  <div class="top-left">
    <div class="top-logo">ç¤¼</div>
    <div class="top-info">
      <div class="top-company">ãƒ†ã‚¹ãƒˆAç¤¾</div>
      <div class="top-user">ä½è—¤ ä¸»ä»»</div>
    </div>
  </div>
  <div class="top-right">
    <button class="notif-btn" onclick="showToast('ğŸ“¢ æ–°ã—ã„ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“')">
      ğŸ””
      <span class="notif-badge">2</span>
    </button>
  </div>
</header>

<!-- ===== PAGE: HOME ===== -->
<div class="page active" id="page-home">
  <div class="sec-header">
    <div>
      <div class="sec-title">ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ ğŸ‘‹</div>
      <div class="sec-sub">2026å¹´2æœˆ3æ—¥ï¼ˆç«ï¼‰</div>
    </div>
  </div>

  <div class="stat-row">
    <div class="stat-box" style="--sc:var(--gold)">
      <div class="stat-label">æ‹…å½“æ¡ˆä»¶æ•°</div>
      <div class="stat-val">6<span class="stat-unit">ä»¶</span></div>
    </div>
    <div class="stat-box" style="--sc:var(--blue)">
      <div class="stat-label">ä»Šæœˆã®å£²ä¸Š</div>
      <div class="stat-val">920<span class="stat-unit">ä¸‡</span></div>
    </div>
    <div class="stat-box" style="--sc:var(--green)">
      <div class="stat-label">ä»Šæ—¥ã®äºˆå®š</div>
      <div class="stat-val">3<span class="stat-unit">ä»¶</span></div>
    </div>
    <div class="stat-box" style="--sc:var(--orange)">
      <div class="stat-label">æœªå®Œäº†ã‚¿ã‚¹ã‚¯</div>
      <div class="stat-val">2<span class="stat-unit">ä»¶</span></div>
    </div>
  </div>

  <!-- Today's Schedule -->
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
      <div style="font-size:0.9rem;font-weight:600;color:var(--t1);">æœ¬æ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
      <button class="btn-sm btn btn-outline" onclick="switchTab('schedule')">å…¨ã¦è¦‹ã‚‹ â†’</button>
    </div>
    <div id="todaySchedule"></div>
  </div>

  <!-- Recent Cases -->
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
    <div style="font-size:0.9rem;font-weight:600;">ç›´è¿‘ã®æ‹…å½“æ¡ˆä»¶</div>
    <button class="btn-sm btn btn-outline" onclick="switchTab('cases')">å…¨ã¦è¦‹ã‚‹ â†’</button>
  </div>
  <div id="homeCases"></div>
</div>

<!-- ===== PAGE: CASES ===== -->
<div class="page" id="page-cases">
  <div class="sec-header">
    <div>
      <div class="sec-title">æ‹…å½“æ¡ˆä»¶</div>
      <div class="sec-sub" id="caseCount">å…¨ 0 ä»¶</div>
    </div>
  </div>

  <div class="filter-row" id="caseFilters"></div>
  <div class="search-wrap">
    <span class="search-icon">ğŸ”</span>
    <input class="form-input" id="caseSearch" placeholder="æ–½ä¸»åãƒ»æ•…äººåã§æ¤œç´¢" oninput="renderCases()">
  </div>
  <div id="caseList"></div>
</div>

<!-- ===== PAGE: ESTIMATE ===== -->
<div class="page" id="page-estimate">
  <div class="sec-header">
    <div>
      <div class="sec-title">è¦‹ç©ä½œæˆ</div>
      <div class="sec-sub">ãƒ—ãƒ©ãƒ³é¸æŠ â†’ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ â†’ ç¢ºèª</div>
    </div>
  </div>

  <!-- Step 1 -->
  <div style="font-size:0.78rem;font-weight:600;color:var(--gold);margin-bottom:8px;letter-spacing:1px;">STEP 1 â€” ãƒ—ãƒ©ãƒ³</div>
  <div class="plan-scroll" id="planScroll"></div>

  <!-- Step 2 -->
  <div style="font-size:0.78rem;font-weight:600;color:var(--gold);margin:18px 0 8px;letter-spacing:1px;">STEP 2 â€” ã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
  <div id="optList"></div>

  <!-- Step 3 -->
  <div style="font-size:0.78rem;font-weight:600;color:var(--gold);margin:18px 0 8px;letter-spacing:1px;">STEP 3 â€” æ–½ä¸»æƒ…å ±</div>
  <div class="card card-sm">
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">æ–½ä¸»å</label>
        <input class="form-input" id="eClient" placeholder="å±±ç”° å¤ªéƒ">
      </div>
      <div class="form-group">
        <label class="form-label">æ•…äººå</label>
        <input class="form-input" id="eDeceased" placeholder="å±±ç”° èŠ±å­">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">é›»è©±ç•ªå·</label>
        <input class="form-input" type="tel" id="ePhone" placeholder="090-xxxx-xxxx">
      </div>
      <div class="form-group">
        <label class="form-label">æ–½è¡Œäºˆå®šæ—¥</label>
        <input class="form-input" type="date" id="eDate">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">å‚™è€ƒ</label>
      <textarea class="form-textarea" id="eNote" placeholder="ç‰¹è¨˜äº‹é …"></textarea>
    </div>
  </div>

  <!-- Summary -->
  <div class="summary-bar" id="estSummary"></div>

  <div style="margin-top:14px;display:flex;flex-direction:column;gap:8px;">
    <button class="btn btn-gold" onclick="saveEst()">ğŸ’¾ è¦‹ç©ã‚’ä¿å­˜</button>
    <button class="btn btn-outline" onclick="showToast('ğŸ–¨ å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒ‡ãƒ¢ï¼‰')">ğŸ–¨ å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
  </div>
</div>

<!-- ===== PAGE: SCHEDULE ===== -->
<div class="page" id="page-schedule">
  <div class="sec-header">
    <div>
      <div class="sec-title">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
      <div class="sec-sub">2026å¹´2æœˆ3æ—¥ï¼ˆç«ï¼‰</div>
    </div>
  </div>

  <div class="filter-row">
    <button class="filter-chip active" onclick="setDayFilter(this,'today')">ä»Šæ—¥</button>
    <button class="filter-chip" onclick="setDayFilter(this,'tomorrow')">æ˜æ—¥</button>
    <button class="filter-chip" onclick="setDayFilter(this,'week')">ä»Šé€±</button>
  </div>

  <div class="card" id="scheduleList"></div>

  <button class="fab" id="fabSchedule" onclick="openAddSchedule()">ï¼‹</button>
</div>

<!-- ===== PAGE: CUSTOMER ===== -->
<div class="page" id="page-customer">
  <div class="sec-header">
    <div>
      <div class="sec-title">é¡§å®¢ç™»éŒ²ãƒ»ç·¨é›†</div>
      <div class="sec-sub">æ–½ä¸»ãƒ»æ•…äººæƒ…å ±ã®ç®¡ç†</div>
    </div>
  </div>

  <div class="search-wrap">
    <span class="search-icon">ğŸ”</span>
    <input class="form-input" id="custSearch" placeholder="æ–½ä¸»åãƒ»æ•…äººåã§æ¤œç´¢" oninput="renderCustomers()">
  </div>

  <div id="custList"></div>

  <button class="fab" id="fabCustomer" onclick="openAddCustomer()">ï¼‹</button>
</div>

<!-- Bottom Nav -->
<nav class="bottom-nav">
  <button class="nav-tab active" data-page="home">
    <span class="nav-tab-icon">ğŸ </span>
    <span class="nav-tab-label">ãƒ›ãƒ¼ãƒ </span>
  </button>
  <button class="nav-tab" data-page="cases">
    <span class="nav-tab-icon">ğŸ“</span>
    <span class="nav-tab-label">æ¡ˆä»¶</span>
  </button>
  <button class="nav-tab" data-page="estimate">
    <span class="nav-tab-icon">ğŸ“‹</span>
    <span class="nav-tab-label">è¦‹ç©</span>
  </button>
  <button class="nav-tab" data-page="schedule">
    <span class="nav-tab-icon">ğŸ“…</span>
    <span class="nav-tab-label">äºˆå®š</span>
  </button>
  <button class="nav-tab" data-page="customer">
    <span class="nav-tab-icon">ğŸ‘¤</span>
    <span class="nav-tab-label">é¡§å®¢</span>
  </button>
</nav>

<!-- Bottom Sheet (Detail / Add) -->
<div class="sheet-overlay" id="sheetOverlay" onclick="closeSheet()"></div>
<div class="sheet" id="sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title" id="sheetTitle"></div>
  <div id="sheetContent"></div>
</div>

<script>
// ================================================================
// DATA
// ================================================================

const PLANS = [
  { id:'family', name:'å®¶æ—è‘¬', price:580000, desc:'ã€œ30å' },
  { id:'general', name:'ä¸€èˆ¬è‘¬', price:1200000, desc:'30ã€œ100å' },
  { id:'premium', name:'ç‰¹åˆ¥è‘¬', price:2200000, desc:'100åã€œ' },
];

const OPTIONS = [
  { id:'flower', name:'ç¥­å£‡ç”ŸèŠ±ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—', price:88000 },
  { id:'photo', name:'éºå½±å†™çœŸåŠ å·¥', price:33000 },
  { id:'movie', name:'ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ãƒ ãƒ¼ãƒ“ãƒ¼', price:55000 },
  { id:'food', name:'é€šå¤œæŒ¯ã‚‹èˆã„ï¼ˆ30åï¼‰', price:120000 },
  { id:'return', name:'é¦™å…¸è¿”ã—ï¼ˆ50å€‹ï¼‰', price:150000 },
  { id:'car', name:'éœŠæŸ©è»Šã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—', price:44000 },
  { id:'priest', name:'åƒ§ä¾¶æ‰‹é…', price:200000 },
  { id:'kenpai', name:'ç¤¼ï¼ˆé éš”çŒ®æ¯ï¼‰å°å…¥', price:0 },
];

const MY_CASES = [
  { id:1, client:'å±±ç”° å¤ªéƒ', deceased:'å±±ç”° èŠ±å­', date:'2026-02-10', area:'æ±äº¬éƒ½', plan:'å®¶æ—è‘¬', amount:710000, status:'æº–å‚™ä¸­', phone:'090-1234-5678', address:'æ±äº¬éƒ½ä¸–ç”°è°·åŒºæˆåŸ1-2-3', rel:'é…å¶è€…', note:'å‚åˆ—è€…25åã€‚ç”ŸèŠ±ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã€‚' },
  { id:2, client:'åŠ è—¤ èª ', deceased:'åŠ è—¤ ãƒãƒ«', date:'2026-02-05', area:'åƒè‘‰çœŒ', plan:'ä¸€èˆ¬è‘¬', amount:1350000, status:'æº–å‚™ä¸­', phone:'080-5678-9012', address:'èˆ¹æ©‹å¸‚æœ¬ç”º5-6-7', rel:'é•·ç”·', note:'é€šå¤œæŒ¯ã‚‹èˆã„50ååˆ†ã€‚é¦™å…¸è¿”ã—ã€‚' },
  { id:3, client:'æ–‰è—¤ è£•å­', deceased:'æ–‰è—¤ æ­¦ç”·', date:'2026-01-28', area:'æ±äº¬éƒ½', plan:'å®¶æ—è‘¬', amount:750000, status:'å®Œäº†', phone:'080-1111-2222', address:'æ±äº¬éƒ½ä¸­é‡åŒºæ–°äº•1-1-1', rel:'é…å¶è€…', note:'ç”ŸèŠ±ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã€‚ãƒ ãƒ¼ãƒ“ãƒ¼ã€‚' },
  { id:4, client:'ç”°å£ æ­£ç¾©', deceased:'ç”°å£ å…‰å­', date:'2026-01-20', area:'ç¥å¥ˆå·çœŒ', plan:'ä¸€èˆ¬è‘¬', amount:1280000, status:'å®Œäº†', phone:'070-3333-4444', address:'æ¨ªæµœå¸‚è¥¿åŒºèŠ±å’²ç”º3-3-3', rel:'é•·ç”·', note:'éœŠæŸ©è»Šã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã€‚' },
  { id:5, client:'è¥¿æ‘ å¥å¤ª', deceased:'è¥¿æ‘ ã‚­ãƒ¨', date:'2026-01-12', area:'åŸ¼ç‰çœŒ', plan:'å®¶æ—è‘¬', amount:630000, status:'å®Œäº†', phone:'090-5555-6666', address:'ã•ã„ãŸã¾å¸‚æµ¦å’ŒåŒº4-4-4', rel:'é•·ç”·', note:'ã‚·ãƒ³ãƒ—ãƒ«ãªå®¶æ—è‘¬ã€‚' },
  { id:6, client:'ä½ã€…æœ¨ ä¸€éƒ', deceased:'ä½ã€…æœ¨ ç¯€å­', date:'2025-12-25', area:'æ±äº¬éƒ½', plan:'ç‰¹åˆ¥è‘¬', amount:2500000, status:'å®Œäº†', phone:'080-7777-8888', address:'æ±äº¬éƒ½æ¸¯åŒºèµ¤å‚5-5-5', rel:'é•·ç”·', note:'å¤§è¦æ¨¡ç¤¾è‘¬å¯¾å¿œã€‚' },
];

const SCHEDULES = {
  today: [
    { time:'09:00', title:'å±±ç”°å®¶ æ‰“ã¡åˆã‚ã›', detail:'æ–½ä¸»ã”è‡ªå®…ã«ã¦ã€‚ç¥­å£‡ç”ŸèŠ±ã®æœ€çµ‚ç¢ºèªã€‚', color:'var(--gold)', tag:'æ‰“åˆã›' },
    { time:'13:00', title:'åŠ è—¤å®¶ é€šå¤œãƒªãƒãƒ¼ã‚µãƒ«', detail:'èˆ¹æ©‹ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ãƒ›ãƒ¼ãƒ«ã€‚å—ä»˜è¨­å–¶ã®ç¢ºèªã€‚', color:'var(--blue)', tag:'æ–½è¡Œæº–å‚™' },
    { time:'16:00', title:'æ–°è¦ç›¸è«‡ â€” ä¸­æ‘æ§˜', detail:'æ¥ç¤¾ç›¸è«‡ã€‚ä¸€èˆ¬è‘¬ã‚’æ¤œè¨ä¸­ã¨ã®ã“ã¨ã€‚', color:'var(--green)', tag:'ç›¸è«‡' },
  ],
  tomorrow: [
    { time:'10:00', title:'åŠ è—¤å®¶ é€šå¤œ', detail:'èˆ¹æ©‹ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ãƒ›ãƒ¼ãƒ«ã€‚17:00é–‹å¼ã€‚', color:'var(--orange)', tag:'æ–½è¡Œ' },
    { time:'14:00', title:'æœˆæ¬¡å ±å‘Šæ›¸ ä½œæˆ', detail:'ä»Šæœˆã®æ–½è¡Œå®Ÿç¸¾ã‚’ã¾ã¨ã‚ã€‚', color:'var(--blue)', tag:'äº‹å‹™' },
  ],
  week: [
    { time:'2/3 09:00', title:'å±±ç”°å®¶ æ‰“ã¡åˆã‚ã›', detail:'æ–½ä¸»ã”è‡ªå®…ã«ã¦ã€‚', color:'var(--gold)', tag:'æ‰“åˆã›' },
    { time:'2/3 13:00', title:'åŠ è—¤å®¶ é€šå¤œãƒªãƒãƒ¼ã‚µãƒ«', detail:'èˆ¹æ©‹ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ãƒ›ãƒ¼ãƒ«ã€‚', color:'var(--blue)', tag:'æ–½è¡Œæº–å‚™' },
    { time:'2/3 16:00', title:'æ–°è¦ç›¸è«‡ â€” ä¸­æ‘æ§˜', detail:'æ¥ç¤¾ç›¸è«‡ã€‚', color:'var(--green)', tag:'ç›¸è«‡' },
    { time:'2/4 10:00', title:'åŠ è—¤å®¶ é€šå¤œ', detail:'èˆ¹æ©‹ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ãƒ›ãƒ¼ãƒ«ã€‚', color:'var(--orange)', tag:'æ–½è¡Œ' },
    { time:'2/4 14:00', title:'æœˆæ¬¡å ±å‘Šæ›¸ ä½œæˆ', detail:'', color:'var(--blue)', tag:'äº‹å‹™' },
    { time:'2/5 10:00', title:'åŠ è—¤å®¶ å‘Šåˆ¥å¼', detail:'èˆ¹æ©‹ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ãƒ›ãƒ¼ãƒ«ã€‚10:00é–‹å¼ã€‚', color:'var(--orange)', tag:'æ–½è¡Œ' },
    { time:'2/7 11:00', title:'ç¤¾å†…ç ”ä¿®', detail:'æ–°ã‚·ã‚¹ãƒ†ãƒ æ“ä½œç ”ä¿®ã€‚', color:'var(--green)', tag:'ç ”ä¿®' },
    { time:'2/10 09:00', title:'å±±ç”°å®¶ é€šå¤œ', detail:'ä¸–ç”°è°·ã‚»ãƒ¬ãƒ¢ãƒ‹ãƒ¼ãƒ›ãƒ¼ãƒ«ã€‚', color:'var(--orange)', tag:'æ–½è¡Œ' },
  ]
};

const CUSTOMERS = [
  ...MY_CASES,
  { id:7, client:'æ¾æœ¬ éš†', deceased:'æ¾æœ¬ ä¿¡ä¸€', date:'2025-12-28', area:'ç¥å¥ˆå·çœŒ', plan:'ä¸€èˆ¬è‘¬', amount:1280000, status:'å®Œäº†', phone:'090-7890-1234', address:'å·å´å¸‚ä¸­åŸåŒº7-8-9', rel:'é•·ç”·', note:'å¹´æœ«å¯¾å¿œã€‚' },
  { id:8, client:'äº•ä¸Š ç›´ç¾', deceased:'äº•ä¸Š ä¸‰éƒ', date:'2025-12-20', area:'æ±äº¬éƒ½', plan:'ç‰¹åˆ¥è‘¬', amount:2350000, status:'å®Œäº†', phone:'080-8901-2345', address:'æ±äº¬éƒ½æ–‡äº¬åŒº8-9-10', rel:'é•·å¥³', note:'å¤§è¦æ¨¡ã€‚åƒ§ä¾¶æ‰‹é…ã€‚' },
];

// ================================================================
// STATE
// ================================================================

let selPlan = null;
let optState = {};
OPTIONS.forEach(o => { optState[o.id] = o.id === 'kenpai'; });
let caseFilter = 'all';
let dayFilter = 'today';

// ================================================================
// NAVIGATION
// ================================================================

document.querySelectorAll('.nav-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    switchTab(this.dataset.page);
  });
});

function switchTab(page) {
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  const tab = document.querySelector(`.nav-tab[data-page="${page}"]`);
  if (tab) tab.classList.add('active');
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  // FABs
  document.getElementById('fabSchedule').classList.toggle('hidden', page !== 'schedule');
  document.getElementById('fabCustomer').classList.toggle('hidden', page !== 'customer');
}

// ================================================================
// HELPERS
// ================================================================

function yen(n) { return 'Â¥' + n.toLocaleString(); }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

function openSheet(title, html) {
  document.getElementById('sheetTitle').textContent = title;
  document.getElementById('sheetContent').innerHTML = html;
  document.getElementById('sheetOverlay').classList.add('show');
  document.getElementById('sheet').classList.add('show');
}

function closeSheet() {
  document.getElementById('sheetOverlay').classList.remove('show');
  document.getElementById('sheet').classList.remove('show');
}

// ================================================================
// HOME
// ================================================================

function renderHome() {
  // Today schedule
  const today = SCHEDULES.today;
  document.getElementById('todaySchedule').innerHTML = today.map(s => `
    <div class="sched-item">
      <div class="sched-time">
        <div class="sched-hour">${s.time.split(':')[0]}</div>
        <div class="sched-min">:${s.time.split(':')[1]}</div>
      </div>
      <div class="sched-line" style="--sl:${s.color}"></div>
      <div class="sched-body">
        <div class="sched-title">${s.title}</div>
        <div class="sched-detail">${s.detail}</div>
        <div class="sched-tag"><span class="tag tag-gold">${s.tag}</span></div>
      </div>
    </div>
  `).join('');

  // Recent cases (top 3)
  document.getElementById('homeCases').innerHTML = MY_CASES.slice(0, 3).map(c => caseHTML(c)).join('');
}

// ================================================================
// CASES
// ================================================================

function caseHTML(c) {
  const icon = c.status === 'å®Œäº†' ? 'âœ…' : 'â³';
  const tagCls = c.status === 'å®Œäº†' ? 'tag-green' : 'tag-orange';
  return `<div class="case-item" onclick="showCaseDetail(${c.id})">
    <div class="case-icon">${icon}</div>
    <div class="case-body">
      <div class="case-name">${c.deceased} æ§˜</div>
      <div class="case-meta">
        <span class="tag ${tagCls}">${c.status}</span>
        <span>${c.plan}</span>
        <span>${c.area}</span>
      </div>
    </div>
    <div class="case-right">
      <div class="case-amount">${yen(c.amount)}</div>
      <div class="case-date">${c.date}</div>
    </div>
  </div>`;
}

function renderCases() {
  const q = (document.getElementById('caseSearch')?.value || '').toLowerCase();
  let list = MY_CASES.filter(c => {
    const matchQ = !q || c.client.toLowerCase().includes(q) || c.deceased.toLowerCase().includes(q);
    const matchF = caseFilter === 'all' || c.status === (caseFilter === 'active' ? 'æº–å‚™ä¸­' : 'å®Œäº†');
    return matchQ && matchF;
  });

  document.getElementById('caseCount').textContent = `å…¨ ${list.length} ä»¶`;
  document.getElementById('caseList').innerHTML = list.length > 0 ?
    list.map(c => caseHTML(c)).join('') :
    '<div class="empty"><div class="empty-icon">ğŸ“‚</div><div class="empty-text">è©²å½“ã™ã‚‹æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“</div></div>';
}

function renderCaseFilters() {
  const filters = [
    { id:'all', label:'ã™ã¹ã¦' },
    { id:'active', label:'æº–å‚™ä¸­' },
    { id:'done', label:'å®Œäº†' },
  ];
  document.getElementById('caseFilters').innerHTML = filters.map(f =>
    `<button class="filter-chip ${caseFilter===f.id?'active':''}" onclick="setCaseFilter('${f.id}')">${f.label}</button>`
  ).join('');
}

function setCaseFilter(f) {
  caseFilter = f;
  renderCaseFilters();
  renderCases();
}

function showCaseDetail(id) {
  const c = MY_CASES.find(x => x.id === id) || CUSTOMERS.find(x => x.id === id);
  if (!c) return;
  openSheet(c.deceased + ' æ§˜', `
    <div class="detail-grid">
      <div class="detail-box"><div class="detail-label">æ–½ä¸»å</div><div class="detail-val">${c.client}</div></div>
      <div class="detail-box"><div class="detail-label">æ•…äººå</div><div class="detail-val">${c.deceased}</div></div>
      <div class="detail-box"><div class="detail-label">æ–½è¡Œæ—¥</div><div class="detail-val">${c.date}</div></div>
      <div class="detail-box"><div class="detail-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div><div class="detail-val"><span class="tag ${c.status==='å®Œäº†'?'tag-green':'tag-orange'}">${c.status}</span></div></div>
      <div class="detail-box"><div class="detail-label">é›»è©±ç•ªå·</div><div class="detail-val">${c.phone}</div></div>
      <div class="detail-box"><div class="detail-label">ãƒ—ãƒ©ãƒ³</div><div class="detail-val">${c.plan}</div></div>
      <div class="detail-box"><div class="detail-label">é‡‘é¡</div><div class="detail-val" style="color:var(--gold);font-size:1.05rem;">${yen(c.amount)}</div></div>
      <div class="detail-box"><div class="detail-label">ç¶šæŸ„</div><div class="detail-val">${c.rel}</div></div>
      <div class="detail-box detail-full"><div class="detail-label">ä½æ‰€</div><div class="detail-val">${c.address}</div></div>
      <div class="detail-box detail-full"><div class="detail-label">å‚™è€ƒ</div><div class="detail-val">${c.note}</div></div>
    </div>
    <div style="margin-top:16px;display:flex;gap:8px;">
      <button class="btn btn-outline" onclick="showToast('ğŸ“ é›»è©±ç™ºä¿¡ï¼ˆãƒ‡ãƒ¢ï¼‰')" style="flex:1;">ğŸ“ é›»è©±</button>
      <button class="btn btn-gold" onclick="closeSheet();switchTab('estimate')" style="flex:1;">ğŸ“‹ è¦‹ç©ä½œæˆ</button>
    </div>
  `);
}

// ================================================================
// ESTIMATE
// ================================================================

function renderEstimate() {
  document.getElementById('planScroll').innerHTML = PLANS.map(p => `
    <div class="plan-chip ${selPlan===p.id?'selected':''}" onclick="pickPlan('${p.id}')">
      <div class="plan-chip-name">${p.name}</div>
      <div class="plan-chip-price">${yen(p.price)}</div>
      <div class="plan-chip-desc">${p.desc}</div>
    </div>
  `).join('');

  document.getElementById('optList').innerHTML = OPTIONS.map(o => {
    const on = optState[o.id] ? 'on' : '';
    const price = o.price === 0 ? 'ç„¡æ–™' : '+' + yen(o.price);
    return `<div class="opt-item ${on}" onclick="toggleOpt('${o.id}')">
      <div class="opt-left">
        <div class="opt-switch"></div>
        <div class="opt-name">${o.name}</div>
      </div>
      <div class="opt-price">${price}</div>
    </div>`;
  }).join('');

  updateEstSummary();
}

function pickPlan(id) {
  selPlan = id;
  renderEstimate();
}

function toggleOpt(id) {
  optState[id] = !optState[id];
  renderEstimate();
}

function updateEstSummary() {
  const el = document.getElementById('estSummary');
  let lines = [];
  let sub = 0;

  if (selPlan) {
    const p = PLANS.find(x => x.id === selPlan);
    lines.push({ n: p.name, v: p.price });
    sub += p.price;
  }
  OPTIONS.forEach(o => {
    if (optState[o.id] && o.price > 0) {
      lines.push({ n: o.name, v: o.price });
      sub += o.price;
    }
    if (optState[o.id] && o.price === 0) {
      lines.push({ n: o.name, v: 0 });
    }
  });

  const tax = Math.round(sub * 0.1);
  const total = sub + tax;

  el.innerHTML = (lines.length > 0 ?
    lines.map(l => `<div class="summary-line"><span>${l.n}</span><span class="summary-line-val">${l.v > 0 ? yen(l.v) : 'Â¥0'}</span></div>`).join('') :
    '<div style="text-align:center;color:var(--t3);font-size:0.82rem;padding:8px 0;">ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</div>'
  ) + `
    <hr class="summary-divider">
    <div class="summary-total">
      <span class="summary-total-label">åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</span>
      <span class="summary-total-val">${yen(total)}</span>
    </div>
    <div class="summary-tax">ç¨æŠœ: ${yen(sub)} / æ¶ˆè²»ç¨: ${yen(tax)}</div>
  `;
}

function saveEst() {
  if (!selPlan) { showToast('âš ï¸ ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
  const client = document.getElementById('eClient').value || 'æœªå…¥åŠ›';
  showToast('âœ… è¦‹ç©ã‚’ä¿å­˜ã—ã¾ã—ãŸ â€” ' + client + 'æ§˜');
}

// ================================================================
// SCHEDULE
// ================================================================

function renderSchedule() {
  const data = SCHEDULES[dayFilter] || [];
  document.getElementById('scheduleList').innerHTML = data.length > 0 ?
    data.map(s => `
      <div class="sched-item">
        <div class="sched-time">
          <div class="sched-hour">${s.time.split(':')[0].split(' ').pop()}</div>
          <div class="sched-min">:${s.time.split(':')[1]}</div>
        </div>
        <div class="sched-line" style="--sl:${s.color}"></div>
        <div class="sched-body">
          <div class="sched-title">${s.title}</div>
          ${s.detail ? '<div class="sched-detail">' + s.detail + '</div>' : ''}
          <div class="sched-tag"><span class="tag tag-gold">${s.tag}</span></div>
        </div>
      </div>
    `).join('') :
    '<div class="empty"><div class="empty-icon">ğŸ“…</div><div class="empty-text">äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</div></div>';
}

function setDayFilter(btn, val) {
  dayFilter = val;
  document.querySelectorAll('#page-schedule .filter-chip').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  renderSchedule();
}

function openAddSchedule() {
  openSheet('äºˆå®šã‚’è¿½åŠ ', `
    <div class="form-group">
      <label class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input class="form-input" placeholder="ä¾‹ï¼šå±±ç”°å®¶ æ‰“ã¡åˆã‚ã›">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">æ—¥ä»˜</label>
        <input class="form-input" type="date" value="2026-02-03">
      </div>
      <div class="form-group">
        <label class="form-label">æ™‚é–“</label>
        <input class="form-input" type="time" value="10:00">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">è©³ç´°</label>
      <textarea class="form-textarea" placeholder="å ´æ‰€ã‚„å‚™è€ƒ"></textarea>
    </div>
    <button class="btn btn-gold" onclick="closeSheet();showToast('âœ… äºˆå®šã‚’è¿½åŠ ã—ã¾ã—ãŸ')">è¿½åŠ ã™ã‚‹</button>
  `);
}

// ================================================================
// CUSTOMERS
// ================================================================

function renderCustomers() {
  const q = (document.getElementById('custSearch')?.value || '').toLowerCase();
  const list = CUSTOMERS.filter(c => {
    return !q || c.client.toLowerCase().includes(q) || c.deceased.toLowerCase().includes(q);
  });

  document.getElementById('custList').innerHTML = list.length > 0 ?
    list.map(c => `
      <div class="case-item" onclick="showCustDetail(${c.id})">
        <div class="case-icon">ğŸ‘¤</div>
        <div class="case-body">
          <div class="case-name">${c.client}</div>
          <div class="case-meta">
            <span>æ•…äºº: ${c.deceased}</span>
            <span>${c.area}</span>
          </div>
        </div>
        <div class="case-right">
          <div class="case-amount">${yen(c.amount)}</div>
          <div class="case-date">${c.date}</div>
        </div>
      </div>
    `).join('') :
    '<div class="empty"><div class="empty-icon">ğŸ‘¤</div><div class="empty-text">è©²å½“ã™ã‚‹é¡§å®¢ãŒã„ã¾ã›ã‚“</div></div>';
}

function showCustDetail(id) {
  const c = CUSTOMERS.find(x => x.id === id);
  if (!c) return;
  openSheet(c.client + ' æ§˜', `
    <div class="detail-grid">
      <div class="detail-box"><div class="detail-label">æ–½ä¸»å</div><div class="detail-val">${c.client}</div></div>
      <div class="detail-box"><div class="detail-label">æ•…äººå</div><div class="detail-val">${c.deceased}</div></div>
      <div class="detail-box"><div class="detail-label">æ–½è¡Œæ—¥</div><div class="detail-val">${c.date}</div></div>
      <div class="detail-box"><div class="detail-label">ãƒ—ãƒ©ãƒ³</div><div class="detail-val">${c.plan}</div></div>
      <div class="detail-box"><div class="detail-label">é›»è©±ç•ªå·</div><div class="detail-val">${c.phone}</div></div>
      <div class="detail-box"><div class="detail-label">é‡‘é¡</div><div class="detail-val" style="color:var(--gold)">${yen(c.amount)}</div></div>
      <div class="detail-box detail-full"><div class="detail-label">ä½æ‰€</div><div class="detail-val">${c.address}</div></div>
      <div class="detail-box"><div class="detail-label">ç¶šæŸ„</div><div class="detail-val">${c.rel}</div></div>
      <div class="detail-box detail-full"><div class="detail-label">å‚™è€ƒ</div><div class="detail-val">${c.note}</div></div>
    </div>
    <div style="margin-top:16px;display:flex;gap:8px;">
      <button class="btn btn-outline" onclick="closeSheet();showToast('âœï¸ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ¢ï¼‰')" style="flex:1;">âœï¸ ç·¨é›†</button>
      <button class="btn btn-gold" onclick="showToast('ğŸ“ é›»è©±ç™ºä¿¡ï¼ˆãƒ‡ãƒ¢ï¼‰')" style="flex:1;">ğŸ“ é›»è©±</button>
    </div>
  `);
}

function openAddCustomer() {
  openSheet('æ–°è¦é¡§å®¢ç™»éŒ²', `
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">æ–½ä¸»å</label>
        <input class="form-input" placeholder="å±±ç”° å¤ªéƒ">
      </div>
      <div class="form-group">
        <label class="form-label">æ•…äººå</label>
        <input class="form-input" placeholder="å±±ç”° èŠ±å­">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">é›»è©±ç•ªå·</label>
        <input class="form-input" type="tel" placeholder="090-xxxx-xxxx">
      </div>
      <div class="form-group">
        <label class="form-label">ã‚¨ãƒªã‚¢</label>
        <select class="form-select">
          <option>æ±äº¬éƒ½</option>
          <option>ç¥å¥ˆå·çœŒ</option>
          <option>åŸ¼ç‰çœŒ</option>
          <option>åƒè‘‰çœŒ</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">ä½æ‰€</label>
      <input class="form-input" placeholder="ä½æ‰€ã‚’å…¥åŠ›">
    </div>
    <div class="form-group">
      <label class="form-label">ç¶šæŸ„</label>
      <select class="form-select">
        <option>é…å¶è€…</option>
        <option>é•·ç”·</option>
        <option>é•·å¥³</option>
        <option>ãã®ä»–</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">å‚™è€ƒ</label>
      <textarea class="form-textarea" placeholder="ç‰¹è¨˜äº‹é …"></textarea>
    </div>
    <button class="btn btn-gold" onclick="closeSheet();showToast('âœ… é¡§å®¢ã‚’ç™»éŒ²ã—ã¾ã—ãŸ')">ç™»éŒ²ã™ã‚‹</button>
  `);
}

// ================================================================
// INIT
// ================================================================

function init() {
  renderHome();
  renderCaseFilters();
  renderCases();
  renderEstimate();
  renderSchedule();
  renderCustomers();
  // Hide FABs initially
  document.getElementById('fabSchedule').classList.add('hidden');
  document.getElementById('fabCustomer').classList.add('hidden');
}

init();
</script>
</body>
</html>